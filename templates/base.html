{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Food Ordering System{% endblock %}</title>
    
    <!-- Session Timeout Meta Tags for JavaScript -->
    {% if user_authenticated %}
    <meta name="session-timeout" content="{{ session_timeout }}">
    <meta name="warning-time" content="{{ warning_time }}">
    <meta name="user-authenticated" content="true">
    {% else %}
    <meta name="user-authenticated" content="false">
    {% endif %}
    
    <!-- Tailwind CSS CDN for modern, responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/custom.css' %}">
    
    <style>
        /* ============================================================
           REFINED NAVBAR CUSTOM STYLES
           Advanced animations, glassmorphism, and micro-interactions
           ============================================================ */
        
        /* Smooth fade-in animation for page elements */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Navbar glassmorphism effect with enhanced blur */
        .navbar-glass {
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            background: rgba(255, 255, 255, 0.85);
        }
        
        /* Smooth navbar hide/show transition */
        .navbar-transition {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), 
                        box-shadow 0.3s ease,
                        background 0.3s ease;
        }
        
        /* Enhanced shadow when scrolling */
        .navbar-scrolled {
            box-shadow: 0 10px 40px -10px rgba(251, 146, 60, 0.2),
                        0 4px 20px -5px rgba(0, 0, 0, 0.1);
        }
        
        /* Smooth button press effect */
        .btn-press:active {
            transform: scale(0.97);
        }
        
        /* Glow effect for primary buttons */
        .btn-glow {
            box-shadow: 0 4px 15px -3px rgba(251, 146, 60, 0.4);
            transition: box-shadow 0.3s ease, transform 0.2s ease;
        }
        
        .btn-glow:hover {
            box-shadow: 0 6px 25px -5px rgba(251, 146, 60, 0.5);
        }
        
        /* Floating animation for cart FAB */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        /* Pulse ring animation for notifications */
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        
        .pulse-ring::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            border: 2px solid currentColor;
            animation: pulse-ring 1.5s ease-out infinite;
        }
        
        /* Smooth underline animation for nav links */
        .nav-link-underline {
            position: relative;
        }
        
        .nav-link-underline::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(to right, #f97316, #ef4444);
            transition: width 0.3s ease;
            border-radius: 1px;
        }
        
        .nav-link-underline:hover::after {
            width: 100%;
        }
        
        /* Icon bounce on hover */
        .icon-bounce:hover svg {
            animation: iconBounce 0.5s ease;
        }
        
        @keyframes iconBounce {
            0%, 100% { transform: translateY(0); }
            25% { transform: translateY(-3px); }
            50% { transform: translateY(0); }
            75% { transform: translateY(-2px); }
        }
        
        /* Shimmer loading effect */
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .shimmer {
            background: linear-gradient(90deg, 
                rgba(255,255,255,0) 0%, 
                rgba(255,255,255,0.4) 50%, 
                rgba(255,255,255,0) 100%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        /* Targeted override to prevent button disappearing animations */
        .hover\:scale-105:hover,
        .hover\:scale-\[1\.02\]:hover,
        .hover\:-translate-y-0\.5:hover,
        .hover\:-translate-y-1:hover,
        .hover\:-translate-y-2:hover,
        .hover\:-translate-y-4:hover,
        .hover\:translate-y-1:hover,
        .hover\:translate-y-2:hover,
        .hover\:translate-y-4:hover,
        .hover\:translate-x-1:hover,
        .hover\:translate-x-full:hover,
        .group:hover .group-hover\:scale-110,
        .group:hover .group-hover\:scale-105,
        .group:hover .group-hover\:translate-x-1,
        .group:hover .group-hover\:-translate-x-1,
        .group:hover .group-hover\:translate-x-full {
            transform: none !important;
        }
        
        /* Mobile menu slide animation enhancement */
        .slide-in-right {
            animation: slideInRight 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Backdrop blur animation */
        .backdrop-fade-in {
            animation: backdropFadeIn 0.3s ease;
        }
        
        @keyframes backdropFadeIn {
            from { backdrop-filter: blur(0); opacity: 0; }
            to { backdrop-filter: blur(12px); opacity: 1; }
        }
        
        /* Cart badge pop animation */
        @keyframes badgePop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        .badge-pop {
            animation: badgePop 0.3s ease;
        }
        
        /* Search focus glow */
        .search-glow:focus {
            box-shadow: 0 0 0 3px rgba(251, 146, 60, 0.2),
                        0 4px 15px -3px rgba(251, 146, 60, 0.15);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen" data-user-authenticated="true">
    
    <!-- ============================================================
         REFINED FOOD DELIVERY NAVIGATION BAR - ADVANCED VERSION
         Features: Smart scroll behavior, micro-interactions, glassmorphism,
                  dynamic positioning, enhanced animations, progress indicators
         ============================================================ -->
    {% block navbar %}
    <!-- Progress Bar for Page Loading -->
    <div id="navProgressBar" class="fixed top-0 left-0 w-full h-1 bg-gradient-to-r from-orange-500 to-red-500 transform scale-x-0 transition-transform transition-all duration-300 z-50"></div>
    
    <!-- Smart Navigation with Scroll Behavior and Enhanced Glassmorphism -->
    <nav id="mainNavbar" class="fixed top-1 left-0 right-0 z-40 navbar-transition navbar-glass">
        <div class="container mx-auto px-4">
            <!-- Enhanced Glassmorphism Background Layer with Gradient Border -->
            <div class="absolute inset-0 navbar-glass border border-orange-100/30 shadow-xl shadow-orange-500/10 rounded-2xl mx-4 overflow-hidden">
                <!-- Subtle gradient overlay for depth -->
                <div class="absolute inset-0 bg-gradient-to-r from-orange-50/20 via-transparent to-red-50/20"></div>
                <!-- Shimmer effect on hover -->
                <div class="absolute inset-0 opacity-0 hover:opacity-100 transition-opacity duration-500 shimmer"></div>
            </div>
            
            <!-- Primary Navigation Bar Content -->
            <div class="relative flex items-center justify-between py-4">
                <!-- Logo and Brand with Enhanced Styling and Animations -->
                <div class="flex items-center">
                    <a href="{% url 'customer:home' %}" class="flex items-center space-x-3 group">
                        <div class="relative">
                            <!-- Logo Container with Glow Effect -->
                            <div class="w-12 h-12 bg-gradient-to-br from-orange-400 via-orange-500 to-red-500 rounded-2xl flex items-center justify-center shadow-lg shadow-orange-500/25 group-hover:shadow-xl group-hover:shadow-orange-500/40 duration-500 btn-press">
                                <svg class="w-7 h-7 text-white drop-shadow-sm" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M8.1 13.34l2.83-2.83L3.91 3.5c-1.56 1.56-1.56 4.09 0 5.66l4.19 4.18zm6.78-1.81c1.53.71 3.68.21 5.27-1.38 1.91-1.91 2.28-4.65.81-6.12-1.46-1.46-4.2-1.1-6.12.81-1.59 1.59-2.09 3.74-1.38 5.27L3.7 19.87l1.41 1.41L12 14.41l6.88 6.88 1.41-1.41L13.41 13l1.47-1.47z"/>
                                </svg>
                            </div>
                            <!-- Online Status Indicator with Pulse Ring -->
                            <div class="absolute -top-1 -right-1 w-4 h-4 bg-gradient-to-r from-green-400 to-green-500 rounded-full shadow-lg shadow-green-500/50 pulse-ring">
                            </div>
                        </div>
                        <div>
                            <!-- Brand Name with Gradient Text -->
                            <span class="text-2xl font-extrabold bg-gradient-to-r from-orange-600 via-orange-500 to-red-600 bg-clip-text text-transparent drop-shadow-sm">QuickBite</span>
                            <!-- Delivery Promise Badge -->
                            <div class="text-xs text-orange-500 font-semibold flex items-center">
                                <svg class="w-3 h-3 mr-1 text-green-500" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                </svg>
                                <span class="text-gray-600">Delivered in</span>
                                <span class="ml-1 text-orange-600 font-bold">30 mins</span>
                            </div>
                        </div>
                    </a>
                </div>
                
                    <!-- Enhanced Location Selector with Refined Styling -->
                    <div onclick="openLocationModal()" class="hidden md:flex items-center space-x-3 bg-gradient-to-r from-orange-50/80 to-red-50/80 px-5 py-3 rounded-2xl hover:from-orange-100 hover:to-red-100  duration-300 cursor-pointer group border border-orange-200/40 shadow-sm hover:shadow-lg btn-press">
                        <div class="relative">
                            <!-- Location Icon with Animation -->
                            <svg class="w-6 h-6 text-orange-500 group-hover:text-orange-600  duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            <!-- GPS Active Indicator -->
                            <div class="absolute -bottom-1 -right-1 w-2.5 h-2.5 bg-green-500 rounded-full shadow-lg shadow-green-500/50 border border-white"></div>
                        </div>
                        <div class="text-sm">
                            <div class="font-bold text-gray-900 group-hover:text-orange-600 transition-colors">Deliver to</div>
                            <div class="text-gray-600 group-hover:text-orange-500 transition-colors font-medium" id="currentLocationText">Current Location</div>
                        </div>
                        <!-- Dropdown Arrow with Rotation -->
                        <svg class="w-4 h-4 text-orange-400 group-hover:text-orange-600 group-hover:rotate-180  duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                
                    <!-- Enhanced Search Bar with Refined Styling and Glow Effects -->
                    <div class="hidden lg:flex flex-1 max-w-2xl mx-8">
                        <div class="relative w-full group">
                            <!-- Search Input with Focus Glow -->
                            <input type="text" 
                                   id="mainSearchInput"
                                   placeholder="Search for restaurants, dishes, or cuisines..." 
                                   onkeyup="handleSearchInput(event)"
                                   class="w-full pl-14 pr-32 py-4 bg-gradient-to-r from-white/90 to-orange-50/50 border border-orange-200/40 rounded-2xl focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-transparent  duration-300 text-sm font-medium placeholder-gray-400 shadow-sm group-hover:shadow-md search-glow">
                            <!-- Search Icon -->
                            <svg class="absolute left-5 top-4 w-5 h-5 text-orange-400 group-hover:text-orange-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                            <!-- Voice Search Button -->
                            <button onclick="startVoiceSearch()" class="absolute left-12 top-3.5 p-1.5 hover:bg-orange-100 rounded-xl  duration-200 icon-bounce" title="Voice search">
                                <svg id="voiceSearchIcon" class="w-5 h-5 text-gray-400 hover:text-orange-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                                </svg>
                            </button>
                            <!-- Search Button with Glow -->
                            <div class="absolute right-2 top-2">
                                <button onclick="performSearch()" class="px-5 py-2.5 bg-gradient-to-r from-orange-500 to-red-500 text-white text-sm font-bold rounded-xl hover:from-orange-600 hover:to-red-600  duration-300 flex items-center space-x-2 btn-glow btn-press">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                    </svg>
                                    <span>Search</span>
                                </button>
                            </div>
                            <!-- Enhanced Search Suggestions Dropdown -->
                            <div id="searchSuggestions" class="absolute top-full left-0 right-0 mt-2 bg-white/98 backdrop-blur-2xl rounded-2xl shadow-2xl border border-orange-100/50 opacity-0 invisible  duration-300 z-50 max-h-80 overflow-y-auto">
                                <!-- Suggestions will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                
                    <!-- Enhanced Right Side Actions with Refined Micro-interactions -->
                    <div class="flex items-center space-x-1 md:space-x-2">
                        <!-- Notifications Bell with Ripple Effect and Pulse Ring -->
                        <button class="relative p-3 hover:bg-orange-50/80 rounded-2xl  duration-200 group hidden md:block overflow-hidden icon-bounce btn-press" title="View Notifications" onclick="createRipple(event, this); showNotificationsPanel();">
                            <svg class="w-6 h-6 text-gray-500 group-hover:text-orange-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                            </svg>
                            <!-- Notification Badge with Pulse -->
                            <span class="absolute top-2 right-2 w-2.5 h-2.5 bg-red-500 rounded-full shadow-lg shadow-red-500/50 pulse-ring"></span>
                        </button>
                        
                        <!-- Quick Favorites - Redirects to Wishlist -->
                        <button class="relative p-3 hover:bg-orange-50/80 rounded-2xl  duration-200 group hidden md:block icon-bounce btn-press" title="View Favorites" onclick="toggleHeartAnimation(this); showFavoritesPanel();">
                            <svg class="w-6 h-6 text-gray-500 group-hover:text-red-500 transition-colors" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                            </svg>
                        </button>
                        
                        <!-- Enhanced Cart Button with Bounce Animation -->
                        <button onclick="navigateToCart(event)" class="relative p-3 hover:bg-orange-50/80 rounded-2xl  duration-200 group icon-bounce btn-press overflow-hidden" title="View Cart">
                            <div class="relative">
                                <svg class="w-6 h-6 text-gray-500 group-hover:text-orange-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                                {% if cart_count > 0 %}
                                <!-- Cart Badge with Pop Animation -->
                                <span id="cartBadge" class="absolute -top-2 -right-2 bg-gradient-to-r from-orange-500 to-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center font-bold shadow-lg shadow-orange-500/30 badge-pop">
                                    {{ cart_count }}
                                </span>
                                {% endif %}
                            </div>
                        </button>
                    
                    <!-- Enhanced Session Timer (Subtle with Hover Expansion) -->
                    {% if user_authenticated %}
                    <div id="navbarSessionTimer" class="hidden items-center space-x-2 px-3 py-2 rounded-2xl  duration-300 cursor-pointer hover:bg-orange-50 group"
                         role="timer" 
                         aria-live="polite" 
                         aria-label="Session time remaining"
                         title="Click to extend session">
                        <div class="relative">
                            <svg class="w-4 h-4 text-gray-500 group-hover:text-orange-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <div class="absolute -top-0.5 -right-0.5 w-2 h-2 bg-orange-500 rounded-full opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        </div>
                        <span id="navbarCountdown" class="text-sm font-medium text-gray-700 group-hover:text-orange-600 transition-colors opacity-0 group-hover:opacity-100 max-w-0 group-hover:max-w-20  duration-300" aria-hidden="true">5:00</span>
                        <span id="timerStatus" class="sr-only">Session timer not active</span>
                    </div>
                    {% endif %}
                    
                    <!-- Enhanced Authentication Section -->
                    {% if user.is_authenticated %}
                    <!-- Enhanced User Dropdown -->
                    <div class="relative" id="userDropdown">
                        <button onclick="toggleUserDropdown()" class="flex items-center space-x-3 p-3 bg-gradient-to-r from-orange-50 to-red-50 hover:from-orange-100 hover:to-red-100 rounded-2xl  duration-300 border border-orange-200/50 group">
                            <div class="relative">
                                <div class="w-9 h-9 bg-gradient-to-br from-orange-400 to-red-500 rounded-full flex items-center justify-center shadow-md group-hover:shadow-lg transition-shadow">
                                    <span class="text-white text-sm font-bold">{{ user.username.0|upper }}</span>
                                </div>
                                <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
                            </div>
                            <div class="hidden md:block text-left">
                                <div class="text-sm font-semibold text-gray-900 group-hover:text-orange-600 transition-colors">{{ user.username }}</div>
                                <div class="text-xs text-gray-500">Account</div>
                            </div>
                            <svg class="w-4 h-4 text-orange-600 group-hover:rotate-180 transition-transform transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        
                        <!-- Enhanced Dropdown Menu -->
                        <div id="dropdownMenu" class="absolute right-0 mt-3 w-72 bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-orange-100 opacity-0 invisible  duration-300 py-2 z-50">
                            <!-- User Profile Section -->
                            <div class="px-4 py-4 border-b border-orange-100 bg-gradient-to-r from-orange-50 to-red-50 rounded-t-2xl">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-gradient-to-br from-orange-400 to-red-500 rounded-full flex items-center justify-center shadow-lg">
                                        <span class="text-white text-lg font-bold">{{ user.username.0|upper }}</span>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm font-bold text-gray-900">{{ user.username }}</p>
                                        <p class="text-xs text-gray-600">{{ user.email }}</p>
                                    </div>
                                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                </div>
                            </div>
                            
                            <!-- Navigation Links -->
                            <div class="py-2">
                                <a href="{% url 'customer:profile' %}" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gradient-to-r hover:from-orange-50 hover:to-red-50  duration-200 group">
                                    <svg class="w-5 h-5 mr-3 text-gray-400 group-hover:text-orange-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                    <span class="font-medium group-hover:text-orange-600 transition-colors">My Profile</span>
                                </a>
                                
                                <!-- Dashboard Links - Conditional Based on User Type -->
                                {% if user.restaurants.exists %}
                                <a href="{% url 'restaurant:dashboard' %}" class="flex items-center px-4 py-3 text-sm text-orange-600 hover:bg-gradient-to-r hover:from-orange-50 hover:to-red-50  duration-200 group">
                                    <svg class="w-5 h-5 mr-3 text-orange-400 group-hover:text-orange-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                    <span class="font-semibold group-hover:text-orange-700 transition-colors">Restaurant Dashboard</span>
                                    <span class="ml-auto px-2 py-1 bg-orange-100 text-orange-600 text-xs rounded-full font-medium">Owner</span>
                                </a>
                                {% else %}
                                <a href="{% url 'core:dashboard' %}" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gradient-to-r hover:from-orange-50 hover:to-red-50  duration-200 group">
                                    <svg class="w-5 h-5 mr-3 text-gray-400 group-hover:text-orange-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                    <span class="font-medium group-hover:text-orange-600 transition-colors">Dashboard</span>
                                </a>
                                {% endif %}
                                
                                {% if user.is_staff %}
                                <a href="{% url 'restaurant:manager_dashboard' %}" class="flex items-center px-4 py-3 text-sm text-orange-600 hover:bg-gradient-to-r hover:from-orange-50 hover:to-red-50  duration-200 group">
                                    <svg class="w-5 h-5 mr-3 text-orange-400 group-hover:text-orange-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    <span class="font-semibold group-hover:text-orange-700 transition-colors">Manager Panel</span>
                                    <span class="ml-auto px-2 py-1 bg-red-100 text-red-600 text-xs rounded-full font-medium">Admin</span>
                                </a>
                                {% endif %}
                                
                                <div class="border-t border-orange-100 my-2"></div>
                                
                                <a href="{% url 'customer:cart' %}" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gradient-to-r hover:from-orange-50 hover:to-red-50  duration-200 group">
                                    <svg class="w-5 h-5 mr-3 text-gray-400 group-hover:text-orange-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                    </svg>
                                    <span class="font-medium group-hover:text-orange-600 transition-colors">My Cart</span>
                                    {% if cart_count > 0 %}
                                    <span class="ml-auto bg-gradient-to-r from-orange-500 to-red-500 text-white text-xs rounded-full px-2 py-1 font-bold">{{ cart_count }}</span>
                                    {% endif %}
                                </a>
                                
                                <a href="{% url 'customer:my_wishlist' %}" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gradient-to-r hover:from-orange-50 hover:to-red-50  duration-200 group">
                                    <svg class="w-5 h-5 mr-3 text-gray-400 group-hover:text-orange-500 transition-colors" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                    </svg>
                                    <span class="font-medium group-hover:text-orange-600 transition-colors">My Favorites</span>
                                </a>
                                
                                <a href="{% url 'customer:order_history' %}" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gradient-to-r hover:from-orange-50 hover:to-red-50  duration-200 group">
                                    <svg class="w-5 h-5 mr-3 text-gray-400 group-hover:text-orange-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span class="font-medium group-hover:text-orange-600 transition-colors">Order History</span>
                                </a>
                            </div>
                            
                            <!-- Logout Section -->
                            <div class="border-t border-orange-100 pt-2">
                                <form action="{% url 'core:logout' %}" method="post" class="block" onsubmit="handleLogout(event)">
                                    {% csrf_token %}
                                    <button type="submit" class="flex items-center w-full px-4 py-3 text-sm text-red-600 hover:bg-gradient-to-r hover:from-red-50 hover:to-orange-50  duration-200 text-left group">
                                        <svg class="w-5 h-5 mr-3 text-red-400 group-hover:text-red-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                        </svg>
                                        <span class="font-medium group-hover:text-red-700 transition-colors">Logout</span>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <!-- Enhanced Login/Signup Section -->
                    <div class="flex items-center space-x-3">
                        <a href="{% url 'core:register' %}" class="hidden md:block px-5 py-3 text-sm font-semibold text-gray-700 hover:text-orange-500 transition-colors border border-gray-200 rounded-xl hover:border-orange-300">
                            Sign up
                        </a>
                        <a href="{% url 'core:login' %}" class="px-5 py-3 text-sm font-semibold text-white bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 rounded-xl  duration-300 shadow-lg hover:shadow-xl flex items-center space-x-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                            </svg>
                            <span>Log in</span>
                        </a>
                    </div>
                    {% endif %}
                    
                    <!-- Enhanced Mobile Menu Toggle -->
                    <button onclick="toggleMobileMenu()" class="lg:hidden p-3 hover:bg-orange-50 rounded-2xl  duration-200 group">
                        <svg class="w-6 h-6 text-gray-700 group-hover:text-orange-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ============================================================
             FLOATING ACTION BUTTON (FAB) FOR MOBILE CART ACCESS
             Provides quick cart access on mobile devices with smooth
             animations and visual feedback
             ============================================================ -->
        <div id="mobileCartFAB" class="fixed bottom-6 right-6 z-40 md:hidden">
            <a href="{% url 'customer:cart' %}" class="group relative block">
                <!-- FAB Button with Enhanced Styling -->
                <div class="relative">
                    <div class="w-16 h-16 bg-gradient-to-br from-orange-500 to-red-500 rounded-full shadow-2xl shadow-orange-500/30 flex items-center justify-center  duration-300 group-hover:scale-110 group-hover:shadow-orange-500/40">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        {% if cart_count > 0 %}
                        <span class="absolute -top-1 -right-1 bg-white text-orange-600 text-xs rounded-full w-6 h-6 flex items-center justify-center font-bold shadow-lg animate-bounce border-2 border-orange-200">
                            {{ cart_count }}
                        </span>
                        {% endif %}
                    </div>
                    <!-- Ripple Effect on Hover -->
                    <div class="absolute inset-0 bg-orange-400 rounded-full animate-ping opacity-0 group-hover:opacity-20 transition-opacity transition-all duration-300"></div>
                </div>
                
                <!-- Cart Preview Tooltip (appears on hover) -->
                <div class="absolute bottom-full right-0 mb-3 w-48 bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-orange-100 p-4 opacity-0 invisible group-hover:opacity-100 group-hover:visible  duration-300 transform translate-y-2 group-hover:translate-y-0">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-orange-100 to-red-100 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-semibold text-gray-900">Your Cart</p>
                            {% if cart_count > 0 %}
                            <p class="text-xs text-gray-600">{{ cart_count }} items</p>
                            {% else %}
                            <p class="text-xs text-gray-600">No items</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </a>
        </div>
        
       
        
        <!-- ============================================================
             ENHANCED MOBILE MENU SLIDE-IN PANEL
             Features: Glassmorphism effects, smooth animations with backdrop,
             comprehensive navigation, user authentication, swipe gestures,
             improved touch targets and visual hierarchy
             ============================================================ -->
        <div id="mobileMenu" class="fixed inset-0 z-50 hidden opacity-0 transition-opacity transition-all duration-300">
            <!-- Enhanced Backdrop Overlay with fade-in animation -->
            <div id="mobileMenuBackdrop" class="absolute inset-0 bg-black/60 backdrop-blur-md transition-opacity transition-all duration-300" onclick="toggleMobileMenu()"></div>
            
            <!-- Enhanced Slide-in Menu Panel with smooth animations -->
            <div id="mobileMenuPanel" class="absolute right-0 top-0 h-full w-80 bg-white shadow-2xl transform translate-x-full  duration-300 ease-out">
                <!-- Mobile Menu Header with enhanced styling -->
                <div class="bg-gradient-to-br from-orange-500 via-orange-600 to-red-600 p-4 text-white shadow-lg">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center shadow-lg">
                                <svg class="w-7 h-7 text-white" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M8.1 13.34l2.83-2.83L3.91 3.5c-1.56 1.56-1.56 4.09 0 5.66l4.19 4.18zm6.78-1.81c1.53.71 3.68.21 5.27-1.38 1.91-1.91 2.28-4.65.81-6.12-1.46-1.46-4.2-1.1-6.12.81-1.59 1.59-2.09 3.74-1.38 5.27L3.7 19.87l1.41 1.41L12 14.41l6.88 6.88 1.41-1.41L13.41 13l1.47-1.47z"/>
                                </svg>
                            </div>
                            <div>
                                <div class="font-bold text-lg">QuickBite</div>
                                <div class="text-xs text-white/90 font-medium">Food Delivery</div>
                            </div>
                        </div>
                        <!-- Enhanced Close Button with better touch target -->
                        <button onclick="toggleMobileMenu()" class="p-3 hover:bg-white/20 active:bg-white/30 rounded-xl  duration-200 touch-manipulation" aria-label="Close menu">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- Enhanced Mobile Search Bar with auto-focus -->
                <div class="p-4 border-b border-orange-100 bg-gray-50">
                    <div class="relative">
                        <input type="text" 
                               id="mobileSearchInput"
                               placeholder="Search restaurants or dishes..." 
                               class="w-full pl-12 pr-4 py-4 bg-white border border-gray-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent text-sm font-medium placeholder-gray-500 shadow-sm focus:shadow-md  duration-200 touch-manipulation">
                        <svg class="absolute left-4 top-4 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <!-- Voice search button (enhanced touch target) -->
                        <button class="absolute right-3 top-3 p-2 hover:bg-orange-50 active:bg-orange-100 rounded-xl transition-colors touch-manipulation" title="Voice search (coming soon)">
                            <svg class="w-5 h-5 text-gray-400 hover:text-orange-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- Enhanced Mobile Navigation Links with improved spacing and touch targets -->
                <div class="flex-1 overflow-y-auto">
                    <!-- Main Navigation with better visual hierarchy -->
                    <div class="p-4 space-y-1">
                        <a href="{% url 'customer:home' %}" onclick="toggleMobileMenu()" class="flex items-center space-x-4 p-4 rounded-2xl hover:bg-gradient-to-r hover:from-orange-50 hover:to-red-50 active:bg-orange-100  duration-200 group touch-manipulation">
                            <div class="w-10 h-10 bg-gray-100 group-hover:bg-orange-100 rounded-xl flex items-center justify-center transition-colors">
                                <svg class="w-5 h-5 text-gray-600 group-hover:text-orange-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                                </svg>
                            </div>
                            <span class="font-semibold text-gray-800 group-hover:text-orange-600 transition-colors">Home</span>
                        </a>
                        
                        <a href="{% url 'customer:filter_results' %}" onclick="toggleMobileMenu()" class="flex items-center space-x-4 p-4 rounded-2xl hover:bg-gradient-to-r hover:from-orange-50 hover:to-red-50 active:bg-orange-100  duration-200 group touch-manipulation">
                            <div class="w-10 h-10 bg-gray-100 group-hover:bg-orange-100 rounded-xl flex items-center justify-center transition-colors">
                                <svg class="w-5 h-5 text-gray-600 group-hover:text-orange-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                </svg>
                            </div>
                            <span class="font-semibold text-gray-800 group-hover:text-orange-600 transition-colors">Restaurants</span>
                        </a>
                        
                        <a href="{% url 'customer:menu' %}" onclick="toggleMobileMenu()" class="flex items-center space-x-4 p-4 rounded-2xl hover:bg-gradient-to-r hover:from-orange-50 hover:to-red-50 active:bg-orange-100  duration-200 group touch-manipulation">
                            <div class="w-10 h-10 bg-gray-100 group-hover:bg-orange-100 rounded-xl flex items-center justify-center transition-colors">
                                <svg class="w-5 h-5 text-gray-600 group-hover:text-orange-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                                </svg>
                            </div>
                            <span class="font-semibold text-gray-800 group-hover:text-orange-600 transition-colors">Menu</span>
                        </a>
                        
                        {% if user.is_authenticated %}
                        <a href="{% url 'customer:order_history' %}" onclick="toggleMobileMenu()" class="flex items-center space-x-4 p-4 rounded-2xl hover:bg-gradient-to-r hover:from-orange-50 hover:to-red-50 active:bg-orange-100  duration-200 group touch-manipulation">
                            <div class="w-10 h-10 bg-gray-100 group-hover:bg-orange-100 rounded-xl flex items-center justify-center transition-colors">
                                <svg class="w-5 h-5 text-gray-600 group-hover:text-orange-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <span class="font-semibold text-gray-800 group-hover:text-orange-600 transition-colors">Order History</span>
                        </a>
                        {% endif %}
                    </div>
                    
                    <!-- Enhanced User Section with better visual hierarchy -->
                    {% if user.is_authenticated %}
                    <div class="border-t border-orange-100">
                        <div class="p-4 bg-gradient-to-r from-orange-50 to-red-50">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-gradient-to-br from-orange-400 to-red-500 rounded-full flex items-center justify-center shadow-lg">
                                    <span class="text-white text-lg font-bold">{{ user.username.0|upper }}</span>
                                </div>
                                <div class="flex-1">
                                    <p class="font-bold text-gray-900 text-base">{{ user.username }}</p>
                                    <p class="text-sm text-gray-600">{{ user.email }}</p>
                                </div>
                                <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse shadow-lg shadow-green-500/50"></div>
                            </div>
                        </div>
                        
                        <div class="p-4 space-y-1">
                            <a href="{% url 'customer:profile' %}" onclick="toggleMobileMenu()" class="flex items-center space-x-4 p-4 rounded-2xl hover:bg-gradient-to-r hover:from-orange-50 hover:to-red-50 active:bg-orange-100  duration-200 group touch-manipulation">
                                <div class="w-10 h-10 bg-gray-100 group-hover:bg-orange-100 rounded-xl flex items-center justify-center transition-colors">
                                    <svg class="w-5 h-5 text-gray-600 group-hover:text-orange-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                </div>
                                <span class="font-semibold text-gray-800 group-hover:text-orange-600 transition-colors">My Profile</span>
                            </a>
                            
                            {% if user.restaurants.exists %}
                            <a href="{% url 'restaurant:dashboard' %}" onclick="toggleMobileMenu()" class="flex items-center space-x-4 p-4 rounded-2xl hover:bg-gradient-to-r hover:from-orange-50 hover:to-red-50 active:bg-orange-100  duration-200 group touch-manipulation">
                                <div class="w-10 h-10 bg-orange-100 group-hover:bg-orange-200 rounded-xl flex items-center justify-center transition-colors">
                                    <svg class="w-5 h-5 text-orange-600 group-hover:text-orange-700 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <span class="font-bold text-orange-600 group-hover:text-orange-700 transition-colors">Restaurant Dashboard</span>
                                    <span class="ml-2 px-2 py-1 bg-orange-500 text-white text-xs rounded-full font-medium">Owner</span>
                                </div>
                            </a>
                            {% else %}
                            <a href="{% url 'core:dashboard' %}" onclick="toggleMobileMenu()" class="flex items-center space-x-4 p-4 rounded-2xl hover:bg-gradient-to-r hover:from-orange-50 hover:to-red-50 active:bg-orange-100  duration-200 group touch-manipulation">
                                <div class="w-10 h-10 bg-gray-100 group-hover:bg-orange-100 rounded-xl flex items-center justify-center transition-colors">
                                    <svg class="w-5 h-5 text-gray-600 group-hover:text-orange-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                </div>
                                <span class="font-semibold text-gray-800 group-hover:text-orange-600 transition-colors">Dashboard</span>
                            </a>
                            {% endif %}
                            
                            {% if user.is_staff %}
                            <a href="{% url 'restaurant:manager_dashboard' %}" onclick="toggleMobileMenu()" class="flex items-center space-x-4 p-4 rounded-2xl hover:bg-gradient-to-r hover:from-orange-50 hover:to-red-50 active:bg-orange-100  duration-200 group touch-manipulation">
                                <div class="w-10 h-10 bg-red-100 group-hover:bg-red-200 rounded-xl flex items-center justify-center transition-colors">
                                    <svg class="w-5 h-5 text-red-600 group-hover:text-red-700 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <span class="font-bold text-red-600 group-hover:text-red-700 transition-colors">Manager Panel</span>
                                    <span class="ml-2 px-2 py-1 bg-red-500 text-white text-xs rounded-full font-medium">Admin</span>
                                </div>
                            </a>
                            {% endif %}
                            
                            <a href="{% url 'customer:cart' %}" onclick="toggleMobileMenu()" class="flex items-center space-x-4 p-4 rounded-2xl hover:bg-gradient-to-r hover:from-orange-50 hover:to-red-50 active:bg-orange-100  duration-200 group touch-manipulation">
                                <div class="w-10 h-10 bg-gray-100 group-hover:bg-orange-100 rounded-xl flex items-center justify-center transition-colors relative">
                                    <svg class="w-5 h-5 text-gray-600 group-hover:text-orange-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                    </svg>
                                    {% if cart_count > 0 %}
                                    <span class="absolute -top-1 -right-1 bg-gradient-to-r from-orange-500 to-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center font-bold shadow-lg animate-bounce">{{ cart_count }}</span>
                                    {% endif %}
                                </div>
                                <span class="font-semibold text-gray-800 group-hover:text-orange-600 transition-colors">My Cart</span>
                                {% if cart_count > 0 %}
                                <span class="ml-auto bg-gradient-to-r from-orange-500 to-red-500 text-white text-xs rounded-full px-3 py-1 font-bold">{{ cart_count }}</span>
                                {% endif %}
                            </a>
                            
                            <a href="{% url 'customer:my_wishlist' %}" onclick="toggleMobileMenu()" class="flex items-center space-x-4 p-4 rounded-2xl hover:bg-gradient-to-r hover:from-orange-50 hover:to-red-50 active:bg-orange-100  duration-200 group touch-manipulation">
                                <div class="w-10 h-10 bg-gray-100 group-hover:bg-orange-100 rounded-xl flex items-center justify-center transition-colors">
                                    <svg class="w-5 h-5 text-gray-600 group-hover:text-orange-600 transition-colors" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                    </svg>
                                </div>
                                <span class="font-semibold text-gray-800 group-hover:text-orange-600 transition-colors">My Favorites</span>
                            </a>
                            
                            <form action="{% url 'core:logout' %}" method="post" onsubmit="handleLogout(event); toggleMobileMenu();" class="block">
                                {% csrf_token %}
                                <button type="submit" class="flex items-center w-full space-x-4 p-4 rounded-2xl hover:bg-gradient-to-r hover:from-red-50 hover:to-orange-50 active:bg-red-100  duration-200 group text-left touch-manipulation">
                                    <div class="w-10 h-10 bg-gray-100 group-hover:bg-red-100 rounded-xl flex items-center justify-center transition-colors">
                                        <svg class="w-5 h-5 text-red-600 group-hover:text-red-700 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                        </svg>
                                    </div>
                                    <span class="font-bold text-red-600 group-hover:text-red-700 transition-colors">Logout</span>
                                </button>
                            </form>
                        </div>
                    </div>
                    {% else %}
                    <!-- Enhanced Guest User Section with better buttons -->
                    <div class="border-t border-orange-100 p-4 space-y-3">
                        <a href="{% url 'core:login' %}" onclick="toggleMobileMenu()" class="w-full flex items-center justify-center space-x-3 px-6 py-4 text-base font-bold text-white bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 active:from-orange-700 active:to-orange-800 rounded-2xl  duration-200 shadow-lg hover:shadow-xl touch-manipulation">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                            </svg>
                            <span>Log in</span>
                        </a>
                        <a href="{% url 'core:register' %}" onclick="toggleMobileMenu()" class="w-full flex items-center justify-center px-6 py-4 text-base font-bold text-gray-700 bg-gray-100 hover:bg-gray-200 active:bg-gray-300 rounded-2xl  duration-200 touch-manipulation">
                            <span>Sign up</span>
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>
    {% endblock %}
    
    {% block banners %}
    <!-- Flash Sale Banners - Display active seasonal promotions and flash sales -->
    {% include 'components/flash_sale_banner.html' %}
    {% endblock %}
    
    <!-- Main Content Area -->
    {% block main_wrapper %}
    <main class="container mx-auto px-4 py-8 {% block navbar_spacing %}pt-24{% endblock %}">
        {% block content %}
        {% endblock %}
    </main>
    {% endblock %}
    
    <!-- Footer - Modern Food App Style -->
    {% block footer %}
    <footer class="bg-gradient-to-br from-gray-900 to-gray-800 text-white">
        <div class="container mx-auto px-4 py-12">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Company Info -->
                <div>
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="w-10 h-10 bg-gradient-to-br from-orange-400 to-red-500 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M8.1 13.34l2.83-2.83L3.91 3.5c-1.56 1.56-1.56 4.09 0 5.66l4.19 4.18zm6.78-1.81c1.53.71 3.68.21 5.27-1.38 1.91-1.91 2.28-4.65.81-6.12-1.46-1.46-4.2-1.1-6.12.81-1.59 1.59-2.09 3.74-1.38 5.27L3.7 19.87l1.41 1.41L12 14.41l6.88 6.88 1.41-1.41L13.41 13l1.47-1.47z"/>
                            </svg>
                        </div>
                        <span class="text-xl font-bold">QuickBite</span>
                    </div>
                    <p class="text-gray-300 mb-4">Your favorite food delivery app, bringing delicious meals to your doorstep in minutes.</p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-300 hover:text-orange-400 transition transition-all duration-200">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM5.838 12a6.162 6.162 0 1112.324 0 6.162 6.162 0 01-12.324 0zM12 16a4 4 0 110-8 4 4 0 010 8zm4.965-10.405a1.44 1.44 0 112.881.001 1.44 1.44 0 01-2.881-.001z"/>
                            </svg>
                        </a>
                        <a href="#" class="text-gray-300 hover:text-orange-400 transition transition-all duration-200">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"/>
                            </svg>
                        </a>
                    </div>
                </div>
                
                <!-- Quick Links -->
                <div>
                    <h3 class="text-sm font-semibold text-white mb-4">Quick Links</h3>
                    <ul class="space-y-3">
                        <li><a href="{% url 'customer:home' %}" class="text-sm text-gray-300 hover:text-orange-400 transition transition-all duration-200">Home</a></li>
                        <li><a href="{% url 'customer:filter_results' %}" class="text-sm text-gray-300 hover:text-orange-400 transition transition-all duration-200">Restaurants</a></li>
                        <li><a href="{% url 'customer:menu' %}" class="text-sm text-gray-300 hover:text-orange-400 transition transition-all duration-200">Menu</a></li>
                        <li><a href="{% url 'customer:order_history' %}" class="text-sm text-gray-300 hover:text-orange-400 transition transition-all duration-200">Order History</a></li>
                    </ul>
                </div>
                
                <!-- Support -->
                <div>
                    <h3 class="text-sm font-semibold text-white mb-4">Support</h3>
                    <ul class="space-y-3">
                        <li><a href="#" class="text-sm text-gray-300 hover:text-orange-400 transition transition-all duration-200">Help Center</a></li>
                        <li><a href="#" class="text-sm text-gray-300 hover:text-orange-400 transition transition-all duration-200">Contact Us</a></li>
                        <li><a href="#" class="text-sm text-gray-300 hover:text-orange-400 transition transition-all duration-200">Terms of Service</a></li>
                        <li><a href="#" class="text-sm text-gray-300 hover:text-orange-400 transition transition-all duration-200">Privacy Policy</a></li>
                    </ul>
                </div>
                
                <!-- Contact Info -->
                <div>
                    <h3 class="text-sm font-semibold text-white mb-4">Get in Touch</h3>
                    <ul class="space-y-3 text-sm text-gray-300">
                        <li class="flex items-center">
                            <svg class="w-4 h-4 mr-2 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                            </svg>
                            +91 1234567890
                        </li>
                        <li class="flex items-center">
                            <svg class="w-4 h-4 mr-2 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                            </svg>
                            info@quickbite.com
                        </li>
                        <li class="flex items-center">
                            <svg class="w-4 h-4 mr-2 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            123 Food Street, City
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- Bottom Bar -->
            <div class="border-t border-gray-700 mt-8 pt-8">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <p class="text-sm text-gray-400">&copy; 2024 QuickBite. All rights reserved.</p>
                    <div class="flex space-x-6 mt-4 md:mt-0">
                        <a href="#" class="text-sm text-gray-400 hover:text-orange-400 transition transition-all duration-200">Terms</a>
                        <a href="#" class="text-sm text-gray-400 hover:text-orange-400 transition transition-all duration-200">Privacy</a>
                        <a href="#" class="text-sm text-gray-400 hover:text-orange-400 transition transition-all duration-200">Cookies</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    {% endblock %}
    
    <!-- Custom JavaScript -->
    <script src="{% static 'js/main.js' %}"></script>
    
    <!-- Enhanced Navbar JavaScript Functions -->
    <script>
    /**
     * Toggle User Dropdown Menu
     * Shows/hides the user profile dropdown with smooth animations
     * and manages click-outside behavior for better UX
     */
    function toggleUserDropdown() {
        const dropdownMenu = document.getElementById('dropdownMenu');
        const dropdownButton = event.currentTarget;
        
        if (dropdownMenu.classList.contains('invisible')) {
            // Show dropdown
            dropdownMenu.classList.remove('invisible', 'opacity-0');
            dropdownMenu.classList.add('visible', 'opacity-100');
            dropdownButton.setAttribute('aria-expanded', 'true');
            
            // Add click outside listener
            setTimeout(() => {
                document.addEventListener('click', closeUserDropdownOutside);
            }, 100);
        } else {
            // Hide dropdown
            dropdownMenu.classList.add('invisible', 'opacity-0');
            dropdownMenu.classList.remove('visible', 'opacity-100');
            dropdownButton.setAttribute('aria-expanded', 'false');
            document.removeEventListener('click', closeUserDropdownOutside);
        }
    }
    
    /**
     * Close User Dropdown When Clicking Outside
     * Automatically closes the dropdown if user clicks anywhere else
     * @param {Event} event - The click event
     */
    function closeUserDropdownOutside(event) {
        const userDropdown = document.getElementById('userDropdown');
        const dropdownMenu = document.getElementById('dropdownMenu');
        
        if (!userDropdown.contains(event.target)) {
            dropdownMenu.classList.add('invisible', 'opacity-0');
            dropdownMenu.classList.remove('visible', 'opacity-100');
            document.removeEventListener('click', closeUserDropdownOutside);
        }
    }
    
    /**
     * Hide Sticky Cart Preview
     * Manually hides the sticky cart preview when user clicks close button
     */
    function hideStickyCart() {
        const stickyCart = document.getElementById('stickyCartPreview');
        stickyCart.classList.add('hidden');
    }
    
    /**
     * Handle Logout Form Submission
     * Allows the form to submit normally with optional additional logging
     * @param {Event} event - The form submission event
     */
    function handleLogout(event) {
        console.log('Logout form submitted');
        return true;
    }
    
    /**
     * Enhanced Mobile Menu Toggle with Slide-in Animation
     * Shows/hides the mobile menu with smooth slide-in animation,
     * backdrop fade effects, auto-focus search, and focus trap for accessibility
     */
    function toggleMobileMenu() {
        const mobileMenu = document.getElementById('mobileMenu');
        const menuPanel = document.getElementById('mobileMenuPanel');
        const menuBackdrop = document.getElementById('mobileMenuBackdrop');
        const searchInput = document.getElementById('mobileSearchInput');
        const menuButton = event.currentTarget;
        
        if (mobileMenu.classList.contains('hidden')) {
            // Show menu with backdrop fade-in
            mobileMenu.classList.remove('hidden');
            setTimeout(() => {
                mobileMenu.classList.remove('opacity-0');
                mobileMenu.classList.add('opacity-100');
                menuPanel.classList.remove('translate-x-full');
                menuPanel.classList.add('translate-x-0');
            }, 10);
            menuButton.setAttribute('aria-expanded', 'true');
            
            // Auto-focus search input for better UX
            setTimeout(() => {
                if (searchInput) {
                    searchInput.focus();
                }
            }, 300);
            
            // Focus trap for mobile menu accessibility
            setTimeout(() => {
                trapFocus(mobileMenu);
            }, 350);
        } else {
            // Hide menu with backdrop fade-out
            menuPanel.classList.remove('translate-x-0');
            menuPanel.classList.add('translate-x-full');
            mobileMenu.classList.remove('opacity-100');
            mobileMenu.classList.add('opacity-0');
            menuButton.setAttribute('aria-expanded', 'false');
            
            setTimeout(() => {
                mobileMenu.classList.add('hidden');
            }, 300);
            menuButton.focus();
        }
    }
    
    /**
     * Focus Trap for Accessibility
     * Keeps keyboard focus within the mobile menu for better accessibility
     * @param {HTMLElement} container - The container element to trap focus in
     */
    function trapFocus(container) {
        const focusableElements = container.querySelectorAll(
            'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
        );
        const firstElement = focusableElements[0];
        const lastElement = focusableElements[focusableElements.length - 1];
        
        container.addEventListener('keydown', function(e) {
            if (e.key === 'Tab') {
                if (e.shiftKey) {
                    if (document.activeElement === firstElement) {
                        lastElement.focus();
                        e.preventDefault();
                    }
                } else {
                    if (document.activeElement === lastElement) {
                        firstElement.focus();
                        e.preventDefault();
                    }
                }
            }
        });
        
        firstElement.focus();
    }
    
    /**
     * Unified Scroll Behavior Handler
     * Manages navbar hide/show, progress bar, and sticky cart preview
     * Consolidated for performance and to avoid variable conflicts
     */
    let lastScrollTop = 0;
    let scrollTimer = null;
    let isScrolling = false;
    
    window.addEventListener('scroll', function() {
        const navbar = document.getElementById('mainNavbar');
        const progressBar = document.getElementById('navProgressBar');
        const stickyCart = document.getElementById('stickyCartPreview');
        const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
        
        // Clear existing timer
        clearTimeout(scrollTimer);
        
        if (!isScrolling) {
            isScrolling = true;
            navbar.classList.add('scrolling');
        }
        
        // Hide/show navbar based on scroll direction
        if (currentScroll > lastScrollTop && currentScroll > 100) {
            // Scrolling down - hide navbar
            navbar.style.transform = 'translateY(-120%)';
        } else {
            // Scrolling up - show navbar
            navbar.style.transform = 'translateY(0)';
        }
        
        // Update progress bar based on scroll position
        const scrollPercent = (currentScroll / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
        progressBar.style.transform = `scaleX(${scrollPercent / 100})`;
        
        // Handle sticky cart preview (desktop only)
        if (window.innerWidth >= 768) {
            if (currentScroll > 300) { // Show after scrolling 300px
                scrollTimer = setTimeout(() => {
                    stickyCart.classList.remove('hidden');
                }, 150);
            } else {
                stickyCart.classList.add('hidden');
            }
        }
        
        lastScrollTop = currentScroll;
        
        // Remove scrolling class after scroll ends
        scrollTimer = setTimeout(() => {
            isScrolling = false;
            navbar.classList.remove('scrolling');
        }, 150);
    });
    
    /**
     * Create Ripple Effect on Button Click
     * Material design inspired ripple animation for better feedback
     * @param {Event} event - The click event
     * @param {HTMLElement} button - The button element
     */
    function createRipple(event, button) {
        const ripple = document.createElement('span');
        const rect = button.getBoundingClientRect();
        const size = Math.max(rect.width, rect.height);
        const x = event.clientX - rect.left - size / 2;
        const y = event.clientY - rect.top - size / 2;
        
        ripple.style.width = ripple.style.height = size + 'px';
        ripple.style.left = x + 'px';
        ripple.style.top = y + 'px';
        ripple.classList.add('ripple');
        
        // Add ripple styles if not already present
        if (!document.querySelector('#rippleStyles')) {
            const style = document.createElement('style');
            style.id = 'rippleStyles';
            style.textContent = `
                .ripple {
                    position: absolute;
                    border-radius: 50%;
                    background: rgba(251, 146, 60, 0.3);
                    transform: scale(0);
                    animation: ripple-animation 0.6s ease-out;
                    pointer-events: none;
                }
                @keyframes ripple-animation {
                    to {
                        transform: scale(4);
                        opacity: 0;
                    }
                }
            `;
            document.head.appendChild(style);
        }
        
        button.appendChild(ripple);
        
        setTimeout(() => {
            ripple.remove();
        }, 600);
    }
    
    /**
     * Toggle Heart Animation for Favorites Button
     * Animated heart fill effect when clicking favorites
     * @param {HTMLElement} button - The favorites button
     */
    function toggleHeartAnimation(button) {
        const svg = button.querySelector('svg');
        svg.classList.toggle('fill-red-500');
        svg.classList.toggle('text-red-500');
        
        // Add pulse animation
        svg.style.animation = 'pulse 0.3s ease-in-out';
        setTimeout(() => {
            svg.style.animation = '';
        }, 300);
    }
    
    /**
     * Animate Cart Icon on Click
     * Bounce animation for cart button interaction
     * @param {Event} event - The click event
     */
    function animateCartIcon(event) {
        const cartIcon = event.currentTarget.querySelector('svg');
        cartIcon.style.animation = 'bounce 0.5s ease-in-out';
        setTimeout(() => {
            cartIcon.style.animation = '';
        }, 500);
    }
    
    /**
     * Handle Search Input with Live Suggestions
     * Shows search suggestions as user types
     * @param {Event} event - The keyboard event
     */
    function handleSearchInput(event) {
        const input = event.target;
        const suggestions = document.getElementById('searchSuggestions');
        const query = input.value.trim();
        
        if (query.length > 2) {
            // Show suggestions dropdown
            suggestions.classList.remove('opacity-0', 'invisible');
            suggestions.classList.add('opacity-100', 'visible');
            
            // Mock suggestions (replace with actual search API call)
            suggestions.innerHTML = `
                <div class="p-2">
                    <div class="px-3 py-2 hover:bg-orange-50 rounded-lg cursor-pointer transition-colors">
                        <div class="flex items-center space-x-3">
                            <svg class="w-4 h-4 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                            <span class="text-sm">${query} - Restaurants</span>
                        </div>
                    </div>
                    <div class="px-3 py-2 hover:bg-orange-50 rounded-lg cursor-pointer transition-colors">
                        <div class="flex items-center space-x-3">
                            <svg class="w-4 h-4 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                            <span class="text-sm">${query} - Dishes</span>
                        </div>
                    </div>
                </div>
            `;
        } else {
            // Hide suggestions
            suggestions.classList.add('opacity-0', 'invisible');
            suggestions.classList.remove('opacity-100', 'visible');
        }
        
        // Handle Enter key
        if (event.key === 'Enter') {
            performSearch();
        }
    }
    
    /**
     * Perform Search Action
     * Redirects to search results page with query
     */
    function performSearch() {
        const input = document.getElementById('mainSearchInput');
        const query = input.value.trim();
        if (query) {
            // Redirect to search results (adjust URL as needed)
            window.location.href = `{% url 'customer:filter_results' %}?search=${encodeURIComponent(query)}`;
        }
    }
    
    /**
     * Open Location Modal
     * Shows location selection modal for address management
     * Creates a modal with location options and geolocation support
     */
    function openLocationModal() {
        // Check if modal already exists
        let modal = document.getElementById('locationModal');
        if (modal) {
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            return;
        }
        
        // Create location modal
        modal = document.createElement('div');
        modal.id = 'locationModal';
        modal.className = 'fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm';
        modal.innerHTML = `
            <div class="bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden transform transition-all">
                <!-- Modal Header -->
                <div class="bg-gradient-to-r from-orange-500 to-red-500 p-5 text-white">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            <h3 class="text-lg font-bold">Select Delivery Location</h3>
                        </div>
                        <button onclick="closeLocationModal()" class="p-2 hover:bg-white/20 rounded-xl transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- Modal Body -->
                <div class="p-5 space-y-4">
                    <!-- Use Current Location Button -->
                    <button onclick="getCurrentLocation()" class="w-full flex items-center space-x-4 p-4 bg-gradient-to-r from-orange-50 to-red-50 hover:from-orange-100 hover:to-red-100 rounded-2xl  duration-200 group border border-orange-200/50">
                        <div class="w-12 h-12 bg-gradient-to-br from-orange-400 to-red-500 rounded-xl flex items-center justify-center shadow-lg">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="flex-1 text-left">
                            <div class="font-bold text-gray-900 group-hover:text-orange-600">Use Current Location</div>
                            <div class="text-sm text-gray-500">Using GPS</div>
                        </div>
                        <svg class="w-5 h-5 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </button>
                    
                    <!-- Search Address Input -->
                    <div class="relative">
                        <input type="text" id="addressSearchInput" placeholder="Search for area, street name..." 
                               class="w-full pl-12 pr-4 py-4 bg-gray-50 border border-gray-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent text-sm font-medium">
                        <svg class="absolute left-4 top-4 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                    
                    <!-- Saved Addresses -->
                    <div class="space-y-2">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Saved Addresses</p>
                        
                        <button onclick="selectAddress('Home - 123 Main Street')" class="w-full flex items-center space-x-4 p-4 hover:bg-gray-50 rounded-2xl transition-colors group">
                            <div class="w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center">
                                <svg class="w-5 h-5 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                                </svg>
                            </div>
                            <div class="flex-1 text-left">
                                <div class="font-semibold text-gray-900 group-hover:text-orange-600">Home</div>
                                <div class="text-sm text-gray-500">123 Main Street, City</div>
                            </div>
                        </button>
                        
                        <button onclick="selectAddress('Work - 456 Office Park')" class="w-full flex items-center space-x-4 p-4 hover:bg-gray-50 rounded-2xl transition-colors group">
                            <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center">
                                <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                </svg>
                            </div>
                            <div class="flex-1 text-left">
                                <div class="font-semibold text-gray-900 group-hover:text-orange-600">Work</div>
                                <div class="text-sm text-gray-500">456 Office Park, Business District</div>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // Close on backdrop click
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeLocationModal();
            }
        });
    }
    
    /**
     * Close Location Modal
     * Hides the location selection modal
     */
    function closeLocationModal() {
        const modal = document.getElementById('locationModal');
        if (modal) {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }
    }
    
    /**
     * Get Current Location using Geolocation API
     * Requests user's current GPS location with enhanced error handling
     */
    function getCurrentLocation() {
        const locationText = document.getElementById('currentLocationText');
        
        console.log(' Starting location request...');
        
        // Check if geolocation is supported
        if (!navigator.geolocation) {
            showNotification('Geolocation is not supported by your browser.', 'error');
            return;
        }
        
        // Show loading state
        locationText.textContent = 'Getting location...';
        showNotification('Requesting location access...', 'info');
        
        console.log(' Calling getCurrentPosition...');
        
        // Geolocation options for better accuracy
        const options = {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 0
        };
        
        // Request location - this will trigger browser's permission popup
        navigator.geolocation.getCurrentPosition(
            function(position) {
                // Success - got coordinates
                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;
                const accuracy = position.coords.accuracy;
                
                console.log('Location obtained:', { latitude, longitude, accuracy });
                
                // Use reverse geocoding to get address (simplified version)
                // In production, you'd call a geocoding API like Google Maps or OpenStreetMap
                locationText.textContent = `${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
                
                closeLocationModal();
                showNotification(`Location updated! (Accuracy: ${Math.round(accuracy)}m)`, 'success');
                
                // Store coordinates for later use
                sessionStorage.setItem('userLatitude', latitude);
                sessionStorage.setItem('userLongitude', longitude);
            },
            function(error) {
                // Error handling with specific messages
                let errorMessage = '';
                
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        errorMessage = 'Location access denied. Click to see how to enable it.';
                        locationText.textContent = 'Permission denied';
                        // Show detailed permission instructions
                        showLocationPermissionGuide();
                        break;
                    case error.POSITION_UNAVAILABLE:
                        errorMessage = 'Location information unavailable. Please check your device settings.';
                        locationText.textContent = 'Location unavailable';
                        break;
                    case error.TIMEOUT:
                        errorMessage = 'Location request timed out. Please try again.';
                        locationText.textContent = 'Request timeout';
                        break;
                    default:
                        errorMessage = 'Could not get your location. Please enter manually.';
                        locationText.textContent = 'Location error';
                        break;
                }
                
                console.error('Geolocation error:', error);
                showNotification(errorMessage, 'error');
            },
            options
        );
    }
    
    /**
     * Show Location Permission Guide
     * Displays instructions on how to enable location access in different browsers
     */
    function showLocationPermissionGuide() {
        // Detect browser
        const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
        const isFirefox = /Firefox/.test(navigator.userAgent);
        const isEdge = /Edg/.test(navigator.userAgent);
        const isSafari = /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent);
        
        let instructions = '';
        
        if (isChrome || isEdge) {
            instructions = `
                <div class="space-y-3">
                    <p class="font-semibold text-gray-900">To enable location access in ${isEdge ? 'Edge' : 'Chrome'}:</p>
                    <ol class="list-decimal list-inside space-y-2 text-sm text-gray-700">
                        <li>Click the <strong>lock icon</strong>  or <strong>site settings icon</strong> in the address bar</li>
                        <li>Find <strong>"Location"</strong> in the permissions list</li>
                        <li>Change it from <strong>"Block"</strong> to <strong>"Allow"</strong></li>
                        <li>Refresh the page and try again</li>
                    </ol>
                    <div class="mt-4 p-3 bg-orange-50 rounded-xl border border-orange-200">
                        <p class="text-xs text-orange-700">
                            <strong>Alternative:</strong> Click the address bar, look for a blocked location icon, and click "Allow"
                        </p>
                    </div>
                </div>
            `;
        } else if (isFirefox) {
            instructions = `
                <div class="space-y-3">
                    <p class="font-semibold text-gray-900">To enable location access in Firefox:</p>
                    <ol class="list-decimal list-inside space-y-2 text-sm text-gray-700">
                        <li>Click the <strong>shield icon</strong>  or <strong>lock icon</strong>  in the address bar</li>
                        <li>Click on <strong>"Permissions"</strong></li>
                        <li>Find <strong>"Access Your Location"</strong></li>
                        <li>Uncheck <strong>"Blocked"</strong> and allow access</li>
                        <li>Refresh the page and try again</li>
                    </ol>
                </div>
            `;
        } else if (isSafari) {
            instructions = `
                <div class="space-y-3">
                    <p class="font-semibold text-gray-900">To enable location access in Safari:</p>
                    <ol class="list-decimal list-inside space-y-2 text-sm text-gray-700">
                        <li>Go to <strong>Safari  Settings  Websites</strong></li>
                        <li>Click on <strong>"Location"</strong> in the left sidebar</li>
                        <li>Find this website and change to <strong>"Allow"</strong></li>
                        <li>Refresh the page and try again</li>
                    </ol>
                </div>
            `;
        } else {
            instructions = `
                <div class="space-y-3">
                    <p class="font-semibold text-gray-900">To enable location access:</p>
                    <ol class="list-decimal list-inside space-y-2 text-sm text-gray-700">
                        <li>Click the <strong>lock icon</strong>  in the address bar</li>
                        <li>Look for <strong>"Location"</strong> permissions</li>
                        <li>Change from <strong>"Block"</strong> to <strong>"Allow"</strong></li>
                        <li>Refresh the page and try again</li>
                    </ol>
                </div>
            `;
        }
        
        // Create permission guide modal
        const guideModal = document.createElement('div');
        guideModal.id = 'locationPermissionGuide';
        guideModal.className = 'fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm';
        guideModal.innerHTML = `
            <div class="bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden transform transition-all animate-in">
                <!-- Header -->
                <div class="bg-gradient-to-r from-orange-500 to-red-500 p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                </svg>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold">Location Access Blocked</h3>
                                <p class="text-sm text-white/80">Enable location to continue</p>
                            </div>
                        </div>
                        <button onclick="closePermissionGuide()" class="p-2 hover:bg-white/20 rounded-xl transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- Body -->
                <div class="p-6">
                    ${instructions}
                    
                    <!-- Important Note -->
                    <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-xl">
                        <div class="flex items-start space-x-3">
                            <svg class="w-5 h-5 text-blue-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <div class="text-sm text-blue-700">
                                <strong>Note:</strong> After changing settings, you may need to refresh the page for changes to take effect.
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="mt-6 flex flex-col space-y-3">
                        <button onclick="requestLocationPermission();" class="w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold rounded-xl hover:from-orange-600 hover:to-red-600  duration-300 shadow-lg">
                            Request Permission Again
                        </button>
                        <div class="flex space-x-3">
                            <button onclick="window.location.reload();" class="flex-1 px-6 py-3 bg-blue-500 text-white font-semibold rounded-xl hover:bg-blue-600 transition-colors">
                                Refresh Page
                            </button>
                            <button onclick="closePermissionGuide();" class="flex-1 px-6 py-3 bg-gray-100 text-gray-700 font-semibold rounded-xl hover:bg-gray-200 transition-colors">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(guideModal);
        
        // Close on backdrop click
        guideModal.addEventListener('click', function(e) {
            if (e.target === guideModal) {
                closePermissionGuide();
            }
        });
    }
    
    /**
     * Close Permission Guide Modal
     * Removes the location permission guide from DOM
     */
    function closePermissionGuide() {
        const guide = document.getElementById('locationPermissionGuide');
        if (guide) {
            guide.remove();
        }
    }
    
    /**
     * Request Location Permission
     * Attempts to trigger the browser's native location permission popup
     * This function forces a fresh permission request
     */
    function requestLocationPermission() {
        console.log('Requesting location permission...');
        
        // Close the guide modal first
        closePermissionGuide();
        
        // Show notification
        showNotification('Requesting location access...', 'info');
        
        // Force a fresh geolocation request which should trigger browser popup
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    // Success
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    const accuracy = position.coords.accuracy;
                    
                    console.log('Permission granted! Location:', { latitude, longitude, accuracy });
                    
                    const locationText = document.getElementById('currentLocationText');
                    locationText.textContent = `${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
                    
                    closeLocationModal();
                    showNotification(`Location access granted! (Accuracy: ${Math.round(accuracy)}m)`, 'success');
                    
                    // Store coordinates
                    sessionStorage.setItem('userLatitude', latitude);
                    sessionStorage.setItem('userLongitude', longitude);
                },
                function(error) {
                    // Error - show guide again
                    console.error('Permission denied or error:', error);
                    
                    if (error.code === error.PERMISSION_DENIED) {
                        showNotification('Permission denied. Please follow the guide to enable location access.', 'error');
                        setTimeout(() => {
                            showLocationPermissionGuide();
                        }, 1000);
                    } else {
                        showNotification('Could not get location. Error: ' + error.message, 'error');
                    }
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        } else {
            showNotification('Geolocation is not supported by your browser.', 'error');
        }
    }
    
    /**
     * Select Address from Saved Addresses
     * Updates the delivery location with selected address
     * @param {string} address - The selected address
     */
    function selectAddress(address) {
        const locationText = document.getElementById('currentLocationText');
        locationText.textContent = address.split(' - ')[0]; // Show just "Home" or "Work"
        closeLocationModal();
        showNotification('Delivery location updated!', 'success');
    }
    
    /**
     * Show Notification Toast
     * Displays a temporary notification message
     * @param {string} message - The notification message
     * @param {string} type - The notification type ('success', 'error', 'info')
     */
    function showNotification(message, type = 'info') {
        // Remove existing notification
        const existing = document.getElementById('navNotification');
        if (existing) existing.remove();
        
        // Create notification element
        const notification = document.createElement('div');
        notification.id = 'navNotification';
        notification.className = `fixed top-20 right-4 z-50 px-6 py-4 rounded-2xl shadow-2xl transform  duration-300 translate-x-full`;
        
        // Set colors based on type
        if (type === 'success') {
            notification.classList.add('bg-green-500', 'text-white');
        } else if (type === 'error') {
            notification.classList.add('bg-red-500', 'text-white');
        } else {
            notification.classList.add('bg-orange-500', 'text-white');
        }
        
        notification.innerHTML = `
            <div class="flex items-center space-x-3">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    ${type === 'success' ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>' : 
                      type === 'error' ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>' :
                      '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>'}
                </svg>
                <span class="font-medium">${message}</span>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        // Animate in
        setTimeout(() => {
            notification.classList.remove('translate-x-full');
            notification.classList.add('translate-x-0');
        }, 10);
        
        /* Notifications now stay visible - removed auto-hide to prevent disappearing effect */
        // User can manually close notifications using the X button
    }
    
    /**
     * Show Notifications Panel
     * Displays the notifications dropdown/panel
     */
    function showNotificationsPanel() {
        showNotification('Notifications coming soon!', 'info');
    }
    
    /**
     * Show Favorites Panel
     * Displays the favorites/wishlist panel
     */
    function showFavoritesPanel() {
        // Redirect to wishlist page
        window.location.href = '{% url "customer:my_wishlist" %}';
    }
    
    /**
     * Navigate to Cart Page
     * Handles cart button click with animation and navigation
     * @param {Event} event - The click event
     */
    function navigateToCart(event) {
        // Animate cart icon
        animateCartIcon(event);
        
        // Add ripple effect
        createRipple(event, event.currentTarget);
        
        // Navigate to cart page after animation
        setTimeout(() => {
            window.location.href = '{% url "customer:cart" %}';
        }, 200);
    }
    
    /**
     * Start Voice Search
     * Uses Web Speech API for voice recognition
     */
    function startVoiceSearch() {
        const searchInput = document.getElementById('mainSearchInput');
        const voiceIcon = document.getElementById('voiceSearchIcon');
        
        // Check for browser support
        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
            showNotification('Voice search is not supported in your browser. Try Chrome or Edge.', 'error');
            return;
        }
        
        // Create speech recognition instance
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        
        recognition.lang = 'en-US';
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;
        
        // Visual feedback - change icon color
        voiceIcon.classList.remove('text-gray-400');
        voiceIcon.classList.add('text-red-500', 'animate-pulse');
        searchInput.placeholder = 'Listening...';
        
        recognition.start();
        showNotification('Listening... Speak now!', 'info');
        
        recognition.onresult = function(event) {
            const transcript = event.results[0][0].transcript;
            searchInput.value = transcript;
            
            // Reset visual feedback
            voiceIcon.classList.remove('text-red-500', 'animate-pulse');
            voiceIcon.classList.add('text-gray-400');
            searchInput.placeholder = 'Search for restaurants, dishes, or cuisines...';
            
            showNotification(`Searching for: "${transcript}"`, 'success');
            
            // Trigger search
            setTimeout(() => {
                performSearch();
            }, 500);
        };
        
        recognition.onerror = function(event) {
            // Reset visual feedback
            voiceIcon.classList.remove('text-red-500', 'animate-pulse');
            voiceIcon.classList.add('text-gray-400');
            searchInput.placeholder = 'Search for restaurants, dishes, or cuisines...';
            
            if (event.error === 'no-speech') {
                showNotification('No speech detected. Please try again.', 'error');
            } else if (event.error === 'not-allowed') {
                showNotification('Microphone access denied. Please allow microphone access.', 'error');
            } else {
                showNotification('Voice search error. Please try again.', 'error');
            }
        };
        
        recognition.onend = function() {
            // Reset visual feedback if not already done
            voiceIcon.classList.remove('text-red-500', 'animate-pulse');
            voiceIcon.classList.add('text-gray-400');
            searchInput.placeholder = 'Search for restaurants, dishes, or cuisines...';
        };
    }
    
    /**
     * Debounce Function
     * Limits how often a function can be called
     * @param {Function} func - The function to debounce
     * @param {number} wait - The wait time in milliseconds
     * @returns {Function} - The debounced function
     */
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
    
    // Debounced search input handler for better performance
    const debouncedSearchHandler = debounce(function(event) {
        handleSearchInput(event);
    }, 300);
    
    /**
     * Initialize Enhanced Navbar Features
     * Sets up all navbar functionality when DOM is loaded
     */
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize session timer if user is authenticated
        {% if user_authenticated %}
        const navbarTimer = document.getElementById('navbarSessionTimer');
        if (navbarTimer) {
            navbarTimer.classList.remove('hidden');
            navbarTimer.classList.add('flex');
            
            // Session timer click handler
            navbarTimer.addEventListener('click', function() {
                // Extend session logic would go here
                console.log('Session timer clicked - extend session');
            });
        }
        {% endif %}
        
        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const mobileMenu = document.getElementById('mobileMenu');
            const menuToggle = event.target.closest('button[onclick="toggleMobileMenu()"]');
            
            if (!mobileMenu.contains(event.target) && !menuToggle && !mobileMenu.classList.contains('hidden')) {
                toggleMobileMenu();
            }
        });
        
        // Escape key to close dropdowns and menus
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                // Close user dropdown
                const dropdownMenu = document.getElementById('dropdownMenu');
                if (!dropdownMenu.classList.contains('invisible')) {
                    toggleUserDropdown();
                }
                
                // Close mobile menu
                const mobileMenu = document.getElementById('mobileMenu');
                if (!mobileMenu.classList.contains('hidden')) {
                    toggleMobileMenu();
                }
                
                // Close sticky cart
                const stickyCart = document.getElementById('stickyCartPreview');
                if (!stickyCart.classList.contains('hidden')) {
                    hideStickyCart();
                }
            }
        });
        
        console.log('Enhanced navbar initialized successfully');
    });
    </script>
    
    <!-- Additional Page Scripts -->
    {% block scripts %}
    {% endblock %}
    
</body>
</html>
