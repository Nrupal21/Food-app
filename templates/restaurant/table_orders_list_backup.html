{% extends 'restaurant/restaurant_base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<style>
    /* ============================================
       TABLE ORDERS LIST - MODERN REDESIGN STYLES
       ============================================ */
    
    /* Root Variables for Consistent Theming */
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --danger-color: #ef4444;
        --info-color: #3b82f6;
        --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --card-shadow-hover: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    /* Page Container Styles */
    .orders-page-container {
        min-height: 100vh;
        background: linear-gradient(to bottom, #f9fafb 0%, #f3f4f6 100%);
    }
    
    /* Header Section with Gradient Background */
    .page-header {
        background: var(--primary-gradient);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    /* Filter Section Styles */
    .filter-section {
        background: white;
        border-radius: 16px;
        box-shadow: var(--card-shadow);
        transition: all 0.3s ease;
    }
    
    .filter-section:hover {
        box-shadow: var(--card-shadow-hover);
    }
    
    /* Statistics Cards */
    .stat-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: var(--card-shadow);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        border-left: 4px solid transparent;
    }
    
    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--card-shadow-hover);
    }
    
    .stat-card.blue { border-left-color: #3b82f6; }
    .stat-card.green { border-left-color: #10b981; }
    .stat-card.purple { border-left-color: #8b5cf6; }
    .stat-card.yellow { border-left-color: #f59e0b; }
    .stat-card.red { border-left-color: #ef4444; }
    
    /* Order Card Styles */
    .order-card {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: var(--card-shadow);
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }
    
    .order-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--card-shadow-hover);
        border-color: #667eea;
    }
    
    .order-card.urgent {
        border-color: var(--danger-color);
        animation: pulse-border 2s infinite;
    }
    
    @keyframes pulse-border {
        0%, 100% { border-color: #ef4444; }
        50% { border-color: #fca5a5; }
    }
    
    /* Order Header with Gradient */
    .order-header {
        background: var(--primary-gradient);
        padding: 1.25rem;
        color: white;
        position: relative;
    }
    
    .order-header::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    }
    
    /* Status Badge Styles */
    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .status-badge.pending { background: #fef3c7; color: #92400e; }
    .status-badge.accepted { background: #dbeafe; color: #1e40af; }
    .status-badge.preparing { background: #e9d5ff; color: #6b21a8; }
    .status-badge.ready { background: #d1fae5; color: #065f46; }
    .status-badge.delivered { background: #e5e7eb; color: #374151; }
    .status-badge.completed { background: #d1fae5; color: #065f46; }
    .status-badge.cancelled { background: #fee2e2; color: #991b1b; }
    
    /* Order Type Badge */
    .order-type-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.375rem 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.75rem;
        font-weight: 600;
        backdrop-filter: blur(10px);
    }
    
    .order-type-badge.qr-code { background: rgba(139, 92, 246, 0.2); color: #6b21a8; }
    .order-type-badge.staff { background: rgba(245, 158, 11, 0.2); color: #92400e; }
    .order-type-badge.dine-in { background: rgba(59, 130, 246, 0.2); color: #1e40af; }
    
    /* Table Number Badge */
    .table-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border-radius: 0.75rem;
        font-weight: 700;
        font-size: 1rem;
        border: 2px solid rgba(255, 255, 255, 0.3);
    }
    
    /* Action Buttons */
    .action-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.625rem 1.25rem;
        border-radius: 0.75rem;
        font-size: 0.875rem;
        font-weight: 600;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        border: none;
        cursor: pointer;
    }
    
    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }
    
    .action-btn:active {
        transform: translateY(0);
    }
    
    .action-btn.primary { background: #3b82f6; color: white; }
    .action-btn.primary:hover { background: #2563eb; }
    
    .action-btn.success { background: #10b981; color: white; }
    .action-btn.success:hover { background: #059669; }
    
    .action-btn.warning { background: #f59e0b; color: white; }
    .action-btn.warning:hover { background: #d97706; }
    
    .action-btn.danger { background: #ef4444; color: white; }
    .action-btn.danger:hover { background: #dc2626; }
    
    .action-btn.secondary { background: #6b7280; color: white; }
    .action-btn.secondary:hover { background: #4b5563; }
    
    /* View Toggle Buttons */
    .view-toggle {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        padding: 0.375rem;
        display: inline-flex;
        gap: 0.5rem;
    }
    
    .view-toggle-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.625rem 1.25rem;
        border-radius: 0.625rem;
        font-size: 0.875rem;
        font-weight: 600;
        transition: all 0.2s ease;
        background: transparent;
        color: white;
        border: 2px solid transparent;
    }
    
    .view-toggle-btn:hover {
        background: rgba(255, 255, 255, 0.1);
    }
    
    .view-toggle-btn.active {
        background: white;
        color: #667eea;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    /* Order Items List */
    .order-items-list {
        max-height: 200px;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: #cbd5e1 #f1f5f9;
    }
    
    .order-items-list::-webkit-scrollbar {
        width: 6px;
    }
    
    .order-items-list::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 3px;
    }
    
    .order-items-list::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
    }
    
    .order-items-list::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
    }
    
    /* Order Item Row */
    .order-item-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem;
        background: #f9fafb;
        border-radius: 0.5rem;
        margin-bottom: 0.5rem;
        transition: all 0.2s ease;
    }
    
    .order-item-row:hover {
        background: #f3f4f6;
        transform: translateX(4px);
    }
    
    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        background: white;
        border-radius: 16px;
        box-shadow: var(--card-shadow);
    }
    
    .empty-state-icon {
        width: 120px;
        height: 120px;
        margin: 0 auto 1.5rem;
        opacity: 0.5;
    }
    
    /* Loading Spinner */
    .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    /* Pagination Styles */
    .pagination {
        display: flex;
        gap: 0.5rem;
        justify-content: center;
        align-items: center;
        margin-top: 2rem;
    }
    
    .pagination-btn {
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        background: white;
        color: #667eea;
        font-weight: 600;
        border: 2px solid #667eea;
        transition: all 0.2s ease;
    }
    
    .pagination-btn:hover:not(:disabled) {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
    }
    
    .pagination-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    .pagination-btn.active {
        background: #667eea;
        color: white;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .stat-card {
            padding: 1rem;
        }
        
        .order-card {
            border-radius: 12px;
        }
        
        .action-btn {
            padding: 0.5rem 1rem;
            font-size: 0.8125rem;
        }
        
        .view-toggle {
            width: 100%;
            justify-content: center;
        }
    }
    
    /* Print Styles */
    @media print {
        .filter-section,
        .action-btn,
        .view-toggle,
        .page-header {
            display: none;
        }
        
        .order-card {
            page-break-inside: avoid;
            box-shadow: none;
            border: 1px solid #e5e7eb;
        }
    }
</style>
{% endblock %}

{% block restaurant_content %}
<!-- ============================================
     TABLE ORDERS PAGE - MODERN REDESIGN
     Complete order management interface with
     advanced filtering and real-time updates
     ============================================ -->
<div class="orders-page-container">
    
    <!-- ========== PAGE HEADER ========== -->
    <!-- Header section with gradient background and navigation -->
    <div class="page-header text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                <!-- Page Title and Description -->
                <div class="flex-1">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center text-2xl backdrop-filter backdrop-blur-lg">
                            üìã
                        </div>
                        <div>
                            <h1 class="text-3xl font-bold tracking-tight">
                                {{ title }}
                            </h1>
                            <p class="text-sm opacity-90 mt-1">
                                Comprehensive table order management system
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex flex-wrap items-center gap-3">
                    <!-- View Toggle -->
                    <div class="view-toggle">
                        <button onclick="switchView('grid')" id="gridViewBtn" 
                                class="view-toggle-btn active" 
                                title="Grid View">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                      d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
                            </svg>
                            <span class="hidden sm:inline">Grid</span>
                        </button>
                        <button onclick="switchView('list')" id="listViewBtn" 
                                class="view-toggle-btn" 
                                title="List View">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                      d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                            <span class="hidden sm:inline">List</span>
                        </button>
                    </div>
                    
                    <!-- Quick Access Buttons -->
                    <a href="{% url 'restaurant:active_tables' %}" 
                       class="action-btn secondary">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                        <span class="hidden sm:inline">Active Tables</span>
                    </a>
                    
                    <a href="{% url 'restaurant:create_table_order' %}" 
                       class="action-btn success">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M12 4v16m8-8H4"></path>
                        </svg>
                        <span class="hidden sm:inline">New Order</span>
                    </a>
                    
                    <a href="{% url 'restaurant:dashboard' %}" 
                       class="action-btn primary">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                        </svg>
                        <span class="hidden sm:inline">Dashboard</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== MAIN CONTENT AREA ========== -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- ========== STATISTICS CARDS ========== -->
        <!-- Display key metrics and statistics -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mb-8">
            <!-- Total Orders -->
            <div class="stat-card blue">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-600 mb-1">Total Orders</p>
                        <p class="text-3xl font-bold text-gray-900">{{ orders.paginator.count }}</p>
                        <p class="text-xs text-gray-500 mt-1">All time</p>
                    </div>
                    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                    </div>
                </div>
            </div>
            
            <!-- Active Orders -->
            <div class="stat-card green">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-600 mb-1">Active Orders</p>
                        <p class="text-3xl font-bold text-green-600">{{ active_orders_count }}</p>
                        <p class="text-xs text-gray-500 mt-1">In progress</p>
                    </div>
                    <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>
            
            <!-- QR Code Orders -->
            <div class="stat-card purple">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-600 mb-1">QR Orders</p>
                        <p class="text-3xl font-bold text-purple-600">{{ qr_orders_count }}</p>
                        <p class="text-xs text-gray-500 mt-1">Self-service</p>
                    </div>
                    <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"></path>
                        </svg>
                    </div>
                </div>
            </div>
            
            <!-- Staff Orders -->
            <div class="stat-card yellow">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-600 mb-1">Staff Orders</p>
                        <p class="text-3xl font-bold text-yellow-600">{{ staff_orders_count }}</p>
                        <p class="text-xs text-gray-500 mt-1">Manual entry</p>
                    </div>
                    <div class="w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center">
                        <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                </div>
            </div>
            
            <!-- Completed Today -->
            <div class="stat-card red">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-600 mb-1">Completed</p>
                        <p class="text-3xl font-bold text-gray-900">{{ orders|length }}</p>
                        <p class="text-xs text-gray-500 mt-1">Current page</p>
                    </div>
                    <div class="w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center">
                        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== FILTERS SECTION ========== -->
        <!-- Advanced filtering options for orders -->
        <div class="filter-section p-6 mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-gray-900 flex items-center gap-2">
                    <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                    </svg>
                    Filter Orders
                </h2>
                <button type="button" onclick="toggleFilters()" 
                        class="text-sm text-indigo-600 hover:text-indigo-800 font-medium flex items-center gap-1">
                    <span id="filterToggleText">Hide Filters</span>
                    <svg id="filterToggleIcon" class="w-4 h-4 transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
            </div>
            
            <form method="get" id="filterForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- Status Filter -->
                    <div>
                        <label for="status" class="block text-sm font-semibold text-gray-700 mb-2">
                            <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                      d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Order Status
                        </label>
                        <select name="status" id="status" 
                                class="w-full px-4 py-2.5 bg-white border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="">All Statuses</option>
                            {% for status_value, status_label in status_choices %}
                            <option value="{{ status_value }}" {% if current_status == status_value %}selected{% endif %}>
                                {{ status_label }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <!-- Table Filter -->
                    <div>
                        <label for="table" class="block text-sm font-medium mb-1">Table</label>
                        <select name="table" 
                                id="table" 
                                class="w-full px-3 py-2 bg-white bg-opacity-90 border border-white border-opacity-30 rounded-md focus:ring-2 focus:ring-white focus:border-transparent">
                            <option value="">All Tables</option>
                            {% for table in tables %}
                            <option value="{{ table.id }}" 
                                    {% if current_table == table.id|stringformat:"s" %}selected{% endif %}>
                                Table {{ table.table_number }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <!-- Date From -->
                    <div>
                        <label for="date_from" class="block text-sm font-medium mb-1">From Date</label>
                        <input type="date" 
                               name="date_from" 
                               id="date_from" 
                               value="{{ request.GET.date_from }}"
                               class="w-full px-3 py-2 bg-white bg-opacity-90 border border-white border-opacity-30 rounded-md focus:ring-2 focus:ring-white focus:border-transparent">
                    </div>
                    
                    <!-- Date To -->
                    <div>
                        <label for="date_to" class="block text-sm font-medium mb-1">To Date</label>
                        <input type="date" 
                               name="date_to" 
                               id="date_to" 
                               value="{{ request.GET.date_to }}"
                               class="w-full px-3 py-2 bg-white bg-opacity-90 border border-white border-opacity-30 rounded-md focus:ring-2 focus:ring-white focus:border-transparent">
                    </div>
                </div>
                
                <!-- Search and Actions -->
                <div class="flex flex-col sm:flex-row gap-4">
                    <div class="flex-1">
                        <input type="text" 
                               name="search" 
                               placeholder="Search by Order ID, Customer Name, or Phone..." 
                               value="{{ request.GET.search }}"
                               class="w-full px-4 py-2 bg-white bg-opacity-90 border border-white border-opacity-30 rounded-md focus:ring-2 focus:ring-white focus:border-transparent">
                    </div>
                    <div class="flex space-x-3">
                        <button type="submit" 
                                class="px-4 py-2 bg-white text-indigo-600 font-medium rounded-md hover:bg-gray-100 transition duration-200">
                            üîç Search
                        </button>
                        <a href="{% url 'restaurant:table_orders_list' %}" 
                           class="px-4 py-2 bg-white bg-opacity-20 text-white font-medium rounded-md hover:bg-opacity-30 transition duration-200">
                            Clear Filters
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Orders Display -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            {% if orders %}
            <!-- Statistics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white rounded-lg shadow-sm p-4 border-l-4 border-blue-500">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">Total Orders</p>
                            <p class="text-2xl font-bold text-gray-900">{{ orders.paginator.count }}</p>
                        </div>
                        <div class="text-blue-500">
                            <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-sm p-4 border-l-4 border-green-500">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">Active Orders</p>
                            <p class="text-2xl font-bold text-gray-900">
                                {{ active_orders_count }}
                            </p>
                        </div>
                        <div class="text-green-500">
                            <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-sm p-4 border-l-4 border-purple-500">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">QR Code Orders</p>
                            <p class="text-2xl font-bold text-gray-900">
                                {{ qr_orders_count }}
                            </p>
                        </div>
                        <div class="text-purple-500">
                            <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-sm p-4 border-l-4 border-yellow-500">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">Staff Orders</p>
                            <p class="text-2xl font-bold text-gray-900">
                                {{ staff_orders_count }}
                            </p>
                        </div>
                        <div class="text-yellow-500">
                            <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Table View (Original) -->
            <div class="order-table-container">
                <!-- Orders Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {% for order in orders %}
                    <div class="order-card bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                        <!-- Order Header -->
                        <div class="bg-gradient-to-r from-indigo-500 to-purple-600 p-4 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="font-bold text-lg">Order #{{ order.order_id|slice:":8" }}</h3>
                                    <p class="text-sm opacity-90">{{ order.created_at|date:"M d, Y h:i A" }}</p>
                                </div>
                                <div class="text-right">
                                    {% if order.table %}
                                    <div class="table-number-badge mb-2">
                                        Table {{ order.table.table_number }}
                                    </div>
                                    {% endif %}
                                    <div class="order-type-badge bg-white bg-opacity-20">
                                        {{ order.get_order_type_display }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Order Body -->
                        <div class="p-4">
                            <!-- Customer Info -->
                            <div class="mb-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-semibold text-gray-900">{{ order.customer_name }}</p>
                                {% if order.customer_phone and order.customer_phone != 'N/A' %}
                                <p class="text-sm text-gray-500">{{ order.customer_phone }}</p>
                                {% endif %}
                            </div>
                            <div class="status-badge {{ order.get_status_display_class }}">
                                {{ order.get_status_display }}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Order Items -->
                    <div class="mb-4">
                        <p class="text-sm font-medium text-gray-700 mb-2">Items ({{ order.items.count }})</p>
                        <div class="space-y-1">
                            {% for item in order.items.all|slice:":3" %}
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">{{ item.menu_item.name }}</span>
                                <span class="font-medium">{{ item.quantity }}x</span>
                            </div>
                            {% endfor %}
                            {% if order.items.count > 3 %}
                            <p class="text-sm text-gray-500 italic">...and {{ order.items.count|add:"-3" }} more items</p>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Order Total -->
                    <div class="mb-4 pt-3 border-t border-gray-200">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Total Amount:</span>
                            <span class="text-xl font-bold text-green-600">‚Çπ{{ order.total_amount }}</span>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="flex flex-wrap gap-2">
                        <a href="{% url 'restaurant:order_detail' order.order_id %}" 
                           class="quick-action-btn px-3 py-2 bg-blue-500 text-white text-sm font-medium rounded hover:bg-blue-600">
                            üëÅÔ∏è View Details
                        </a>
                        
                        <a href="{% url 'restaurant:print_kitchen_receipt' order.order_id %}" 
                           target="_blank"
                           class="quick-action-btn px-3 py-2 bg-green-500 text-white text-sm font-medium rounded hover:bg-green-600">
                            üñ®Ô∏è Kitchen Receipt
                        </a>
                        
                        <a href="{% url 'restaurant:print_final_bill' order.order_id %}" 
                           target="_blank"
                           class="quick-action-btn px-3 py-2 bg-purple-500 text-white text-sm font-medium rounded hover:bg-purple-600">
                            üßæ Final Bill
                        </a>
                        
                        {% if order.status not in 'delivered,cancelled' %}
                        <a href="{% url 'restaurant:add_items_to_order' order.order_id %}" 
                           class="quick-action-btn px-3 py-2 bg-yellow-500 text-white text-sm font-medium rounded hover:bg-yellow-600">
                            ‚ûï Add Items
                        </a>
                        {% endif %}
                        
                        {% if order.status == 'delivered' and order.payment_status == 'pending' %}
                        <a href="{% url 'restaurant:mark_order_complete' order.order_id %}" 
                           class="quick-action-btn px-3 py-2 bg-red-500 text-white text-sm font-medium rounded hover:bg-red-600">
                            ‚úÖ Complete Payment
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        </div>

        <!-- Card View (New Order Tracking Layout) -->
        <div class="order-cards-container">
            {% for order in orders %}
            <div class="order-tracking-card 
                {% if order.status == 'delivered' and order.payment_status == 'pending' %}needs-attention{% endif %}
                {% if order.status == 'pending' %}priority{% endif %}"
                data-order-url="{% url 'restaurant:order_detail' order.order_id %}">
                
                <!-- Status Indicator Dot -->
                <div class="status-indicator-dot {{ order.status }}"></div>
                
                <!-- Card Header -->
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold">
                                {{ order.order_id|slice:":8"|upper }}
                            </div>
                            <div>
                                <h3 class="font-bold text-lg text-gray-900">Order #{{ order.order_id|slice:":8"|upper }}</h3>
                                <p class="text-sm text-gray-500">{{ order.created_at|date:"M d, Y h:i A" }}</p>
                            </div>
                        </div>
                        
                        <!-- Table and Order Type -->
                        <div class="text-right">
                            {% if order.table %}
                            <div class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-indigo-100 text-indigo-800 mb-2">
                                ü™ë Table {{ order.table.table_number }}
                            </div>
                            {% endif %}
                            <div class="inline-flex items-center px-2 py-1 rounded text-xs font-medium
                                {% if order.order_type == 'qr_code' %}bg-purple-100 text-purple-800{% endif %}
                                {% if order.order_type == 'staff' %}bg-yellow-100 text-yellow-800{% endif %}
                                {% if order.order_type == 'dine_in' %}bg-blue-100 text-blue-800{% endif %}">
                                {{ order.get_order_type_display }}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Customer Information -->
                    <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-900 flex items-center">
                                    <svg class="w-4 h-4 mr-1 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                    {{ order.customer_name }}
                                </p>
                                {% if order.customer_phone and order.customer_phone != 'N/A' %}
                                <p class="text-sm text-gray-500 flex items-center mt-1">
                                    <svg class="w-3 h-3 mr-1 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                    </svg>
                                    {{ order.customer_phone }}
                                </p>
                                {% endif %}
                            </div>
                            <div class="flex items-center space-x-2">
                                <!-- Order Status Badge -->
                                <span class="px-3 py-1 text-xs font-medium rounded-full
                                    {% if order.status == 'pending' %}bg-yellow-100 text-yellow-800{% endif %}
                                    {% if order.status == 'accepted' %}bg-blue-100 text-blue-800{% endif %}
                                    {% if order.status == 'preparing' %}bg-purple-100 text-purple-800{% endif %}
                                    {% if order.status == 'ready' %}bg-green-100 text-green-800{% endif %}
                                    {% if order.status == 'delivered' %}bg-gray-100 text-gray-800{% endif %}
                                    {% if order.status == 'cancelled' %}bg-red-100 text-red-800{% endif %}">
                                    {{ order.get_status_display }}
                                </span>
                                
                                <!-- Payment Status -->
                                {% if order.payment_status == 'pending' %}
                                <span class="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800">
                                    üí≥ Payment Due
                                </span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Order Items Preview -->
                    <div class="mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="text-sm font-semibold text-gray-700">Order Items</h4>
                            <span class="text-xs text-gray-500">{{ order.items.count }} items</span>
                        </div>
                        <div class="space-y-2">
                            {% for item in order.items.all|slice:":3" %}
                            <div class="flex items-center justify-between p-2 bg-gray-50 rounded cursor-pointer"
                                 data-item-url="{% url 'restaurant:order_detail' order.order_id %}#item-{{ item.id }}">
                                <div class="flex items-center space-x-2">
                                    <span class="text-gray-600 text-sm font-medium">{{ item.menu_item.name }}</span>
                                    {% if item.special_instructions %}
                                    <span class="text-xs text-yellow-600" title="Special instructions: {{ item.special_instructions }}">üìù</span>
                                    {% endif %}
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-sm font-medium text-gray-900">{{ item.quantity }}x</span>
                                    <span class="text-sm text-gray-500">‚Çπ{{ item.total_price }}</span>
                                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                </div>
                            </div>
                            {% endfor %}
                            {% if order.items.count > 3 %}
                            <div class="text-center py-2">
                                <a href="{% url 'restaurant:order_detail' order.order_id %}" 
                                   onclick="event.stopPropagation()"
                                   class="text-xs text-blue-600 hover:text-blue-800 italic">
                                    ...and {{ order.items.count|add:"-3" }} more items (click to view all)
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Order Total and Actions -->
                    <div class="border-t pt-4">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-sm text-gray-600">Total Amount:</span>
                            <span class="text-2xl font-bold text-green-600">‚Çπ{{ order.total_amount }}</span>
                        </div>
                        
                        <!-- Quick Action Buttons -->
                        <div class="grid grid-cols-2 gap-2">
                            <a href="{% url 'restaurant:order_detail' order.order_id %}" 
                               class="px-3 py-2 bg-blue-500 text-white text-sm font-medium rounded-lg text-center">
                                üëÅÔ∏è View
                            </a>
                            
                            {% if order.status not in 'delivered,cancelled' %}
                            <a href="{% url 'restaurant:add_items_to_order' order.order_id %}" 
                               class="px-3 py-2 bg-yellow-500 text-white text-sm font-medium rounded-lg text-center">
                                ‚ûï Add Items
                            </a>
                            {% else %}
                            <a href="{% url 'restaurant:print_final_bill' order.order_id %}" 
                               target="_blank"
                               class="px-3 py-2 bg-purple-500 text-white text-sm font-medium rounded-lg text-center">
                                üßæ Bill
                            </a>
                            {% endif %}
                        </div>
                        
                        <!-- Additional Actions -->
                        <div class="flex space-x-2 mt-2">
                            <a href="{% url 'restaurant:print_kitchen_receipt' order.order_id %}" 
                               target="_blank"
                               class="flex-1 px-2 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded text-center">
                                üñ®Ô∏è Kitchen
                            </a>
                            
                            {% if order.status == 'delivered' and order.payment_status == 'pending' %}
                            <a href="{% url 'restaurant:mark_order_complete' order.order_id %}" 
                               class="flex-1 px-2 py-1 bg-red-500 text-white text-xs font-medium rounded text-center">
                                ‚úÖ Complete Payment
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- NEW: Timeline View Container -->
        <div class="order-timeline-container" style="display: none;">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <!-- Timeline Header -->
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h3 class="text-lg font-bold text-gray-900">‚è∞ Order Timeline</h3>
                        <p class="text-sm text-gray-600">Chronological view of order progression</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- Timeline Legend -->
                        <div class="flex items-center space-x-4 text-xs">
                            <div class="flex items-center space-x-1">
                                <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                <span>Pending</span>
                            </div>
                            <div class="flex items-center space-x-1">
                                <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                                <span>Active</span>
                            </div>
                            <div class="flex items-center space-x-1">
                                <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                <span>Completed</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Timeline Content -->
                <div class="order-timeline">
                    {% for order in orders %}
                    <div class="timeline-item {% if order.status in 'pending,accepted,preparing,ready' %}active{% endif %}">
                        <div class="bg-white rounded-lg border border-gray-200 p-4 cursor-pointer"
                             data-order-url="{% url 'restaurant:order_detail' order.order_id %}">
                            
                            <!-- Timeline Header -->
                            <div class="flex items-start justify-between mb-3">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <h4 class="font-bold text-gray-900">Order #{{ order.order_id|slice:":8" }}</h4>
                                        {% if order.table %}
                                        <span class="px-2 py-1 bg-indigo-100 text-indigo-800 text-xs font-medium rounded-full">
                                            Table {{ order.table.table_number }}
                                        </span>
                                        {% endif %}
                                        <span class="px-2 py-1 bg-gray-100 text-gray-800 text-xs font-medium rounded-full">
                                            {{ order.get_order_type_display }}
                                        </span>
                                    </div>
                                    
                                    <div class="flex items-center space-x-4 text-sm text-gray-600">
                                        <div class="flex items-center space-x-1">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                            </svg>
                                            <span>{{ order.customer_name }}</span>
                                        </div>
                                        <div class="flex items-center space-x-1">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            <span>{{ order.created_at|date:"M d, Y h:i A" }}</span>
                                        </div>
                                        <div class="flex items-center space-x-1">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                            </svg>
                                            <span class="font-bold text-green-600">‚Çπ{{ order.total_amount }}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Status Badge -->
                                <div class="px-3 py-1 text-xs font-medium rounded-full
                                    {% if order.status == 'pending' %}bg-yellow-100 text-yellow-800{% endif %}
                                    {% if order.status == 'accepted' %}bg-blue-100 text-blue-800{% endif %}
                                    {% if order.status == 'preparing' %}bg-purple-100 text-purple-800{% endif %}
                                    {% if order.status == 'ready' %}bg-green-100 text-green-800{% endif %}
                                    {% if order.status == 'delivered' %}bg-gray-100 text-gray-800{% endif %}
                                    {% if order.status == 'cancelled' %}bg-red-100 text-red-800{% endif %}">
                                    {{ order.get_status_display }}
                                </div>
                            </div>
                            
                            <!-- Order Items Preview -->
                            <div class="mb-3">
                                <div class="flex flex-wrap gap-1">
                                    {% for item in order.items.all|slice:":4" %}
                                    <span class="text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded">
                                        {{ item.quantity }}x {{ item.menu_item.name }}
                                    </span>
                                    {% endfor %}
                                    {% if order.items.count > 4 %}
                                    <span class="text-xs text-gray-500 italic">
                                        +{{ order.items.count|add:"-4" }} more items
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- Progress Bar -->
                            <div class="mb-3">
                                <div class="flex items-center justify-between text-xs text-gray-600 mb-1">
                                    <span>Order Progress</span>
                                    <span>{{ order.get_status_display }}</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="h-2 rounded-full
                                        {% if order.status == 'pending' %}bg-yellow-500 w-1/5{% endif %}
                                        {% if order.status == 'accepted' %}bg-blue-500 w-2/5{% endif %}
                                        {% if order.status == 'preparing' %}bg-purple-500 w-3/5{% endif %}
                                        {% if order.status == 'ready' %}bg-green-500 w-4/5{% endif %}
                                        {% if order.status == 'delivered' %}bg-gray-500 w-full{% endif %}
                                        {% if order.status == 'cancelled' %}bg-red-500 w-full{% endif %}">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Quick Actions -->
                            <div class="flex items-center justify-between pt-3 border-t border-gray-100">
                                <div class="flex space-x-2">
                                    <a href="{% url 'restaurant:order_detail' order.order_id %}" 
                                       onclick="event.stopPropagation()"
                                       class="px-3 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded">
                                        View Details
                                    </a>
                                    {% if order.status in 'pending,accepted,preparing,ready' %}
                                    <a href="{% url 'restaurant:add_items_to_order' order.order_id %}" 
                                       onclick="event.stopPropagation()"
                                       class="px-3 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded">
                                        Add Items
                                    </a>
                                    {% endif %}
                                </div>
                                <div class="flex items-center space-x-2">
                                    <a href="{% url 'restaurant:print_kitchen_receipt' order.order_id %}" 
                                       onclick="event.stopPropagation()"
                                       target="_blank"
                                       class="p-1 text-gray-500"
                                       title="Print Kitchen Receipt">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                                        </svg>
                                    </a>
                                    {% if order.status == 'delivered' and order.payment_status == 'pending' %}
                                    <a href="{% url 'restaurant:mark_order_complete' order.order_id %}" 
                                       onclick="event.stopPropagation()"
                                       class="px-3 py-1 bg-red-100 text-red-700 text-xs font-medium rounded">
                                        Complete Payment
                                    </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Pagination (for both views) -->
        {% if orders.has_other_pages %}
        <div class="mt-8 flex justify-center">
            <nav class="flex items-center space-x-2">
                {% if orders.has_previous %}
                <a href="?page={{ orders.previous_page_number }}{{ request.GET.urlencode }}" 
                   class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                    ‚Üê Previous
                </a>
                {% endif %}
                
                {% for num in orders.paginator.page_range %}
                {% if orders.number == num %}
                <span class="px-3 py-2 text-sm font-medium text-white bg-indigo-600 border border-indigo-600 rounded-md">
                    {{ num }}
                </span>
                {% elif num > orders.number|add:'-3' and num < orders.number|add:'3' %}
                <a href="?page={{ num }}{{ request.GET.urlencode }}" 
                   class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                    {{ num }}
                </a>
                {% endif %}
                {% endfor %}
                
                {% if orders.has_next %}
                <a href="?page={{ orders.next_page_number }}{{ request.GET.urlencode }}" 
                   class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                    Next ‚Üí
                </a>
                {% endif %}
            </nav>
        </div>
        {% endif %}

        {% else %}
        <!-- No Orders Found -->
        <div class="text-center py-12">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
            </svg>
            <h3 class="mt-2 text-sm font-medium text-gray-900">No table orders found</h3>
            <p class="mt-1 text-sm text-gray-500">
                {% if request.GET.status or request.GET.table or request.GET.search %}
                Try adjusting your filters or search criteria.
                {% else %}
                No table orders have been created yet.
                {% endif %}
            </p>
            <div class="mt-6">
                <a href="{% url 'restaurant:active_tables' %}" 
                   class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700">
                    Create First Order
                </a>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- JavaScript for View Toggle -->
<script>
/* eslint-disable */
/**
 * Toggle between table, card, and timeline views for order tracking
 */
function toggleView(viewType) {
    const tableView = document.querySelector('.order-table-container');
    const cardsView = document.querySelector('.order-cards-container');
    const timelineView = document.querySelector('.order-timeline-container');
    const tableBtn = document.getElementById('tableViewBtn');
    const cardsBtn = document.getElementById('cardsViewBtn');
    const timelineBtn = document.getElementById('timelineViewBtn');
    
    // Hide all views first
    tableView.classList.add('hidden');
    cardsView.classList.remove('active');
    timelineView.style.display = 'none';
    
    // Remove active state from all buttons
    tableBtn.classList.remove('active');
    cardsBtn.classList.remove('active');
    timelineBtn.classList.remove('active');
    
    if (viewType === 'table') {
        // Show table view
        tableView.classList.remove('hidden');
        tableBtn.classList.add('active');
        
        // Save preference to localStorage
        localStorage.setItem('orderViewPreference', 'table');
    } else if (viewType === 'cards') {
        // Show card view
        cardsView.classList.add('active');
        cardsBtn.classList.add('active');
        
        // Save preference to localStorage
        localStorage.setItem('orderViewPreference', 'cards');
    } else if (viewType === 'timeline') {
        // Show timeline view
        timelineView.style.display = 'block';
        timelineBtn.classList.add('active');
        
        // Save preference to localStorage
        localStorage.setItem('orderViewPreference', 'timeline');
    }
}

/**
 * Initialize view preference on page load
 */
document.addEventListener('DOMContentLoaded', function() {
    // Check for saved view preference
    const savedView = localStorage.getItem('orderViewPreference');
    if (savedView) {
        toggleView(savedView);
    } else {
        // Default to table view
        toggleView('table');
    }
    
    // Add keyboard shortcuts for view switching
    document.addEventListener('keydown', function(e) {
        // Ctrl/Cmd + 1 for table view
        if ((e.ctrlKey || e.metaKey) && e.key === '1') {
            e.preventDefault();
            toggleView('table');
        }
        // Ctrl/Cmd + 2 for card view
        if ((e.ctrlKey || e.metaKey) && e.key === '2') {
            e.preventDefault();
            toggleView('cards');
        }
    });
    
    // Add click prevention for card clicks on action buttons
    document.querySelectorAll('.order-tracking-card a').forEach(function(link) {
        link.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    });
    
    // Add click handlers for order cards with data attributes
    document.addEventListener('click', function(e) {
        // Handle order card clicks
        const orderCard = e.target.closest('[data-order-url]');
        if (orderCard && !e.target.closest('a')) {
            const url = orderCard.getAttribute('data-order-url');
            if (url) {
                window.location.href = url;
            }
        }
        
        // Handle item clicks within order cards
        const itemCard = e.target.closest('[data-item-url]');
        if (itemCard && !e.target.closest('a')) {
            e.stopPropagation();
            const url = itemCard.getAttribute('data-item-url');
            if (url) {
                window.location.href = url;
            }
        }
    });
});

/**
 * Auto-refresh functionality for real-time order tracking
 */
function enableAutoRefresh() {
    // Refresh every 30 seconds for active orders
    setInterval(function() {
        const hasActiveFilters = document.querySelector('select[name="status"]').value || 
                                document.querySelector('select[name="table"]').value || 
                                document.querySelector('input[name="search"]').value;
        
        // Only auto-refresh if no filters are applied to avoid interrupting user workflow
        if (!hasActiveFilters) {
            window.location.reload();
        }
    }, 30000);
}

// Enable auto-refresh after page load
document.addEventListener('DOMContentLoaded', enableAutoRefresh);
/* eslint-enable */
</script>
{% endblock %}
